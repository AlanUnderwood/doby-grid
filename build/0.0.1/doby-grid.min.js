// doby-grid.js 0.0.1
// (c) 2013 Evgueni Naverniouk, Globex Designs, Inc.
// Doby may be freely distributed under the MIT license.
// For all details and documentation:
// https://github.com/globexdesigns/doby-grid
!function(a,b){"use strict";"function"==typeof define&&define.amd?define(["jquery","underscore","backbone"],function(c,d,Backbone){return b(a,c,d,Backbone)}):a.DobyGrid=b(a,a.jQuery||a.$,a._,a.Backbone)}(this,function(a,b,c,Backbone){"use strict";var d=function(a){if(a=a||{},this.NAME="doby-grid",this.VERSION="0.0.1","object"!=typeof a||c.isArray(a))throw new TypeError('The "options" param must be an object.');"object"!=typeof window.console&&(window.console={});var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,$,_,ab,bb,cb,db,eb,fb,gb,hb,ib,jb,kb,lb,mb,nb,ob,pb,qb,rb,sb,tb,ub,vb,wb,xb,yb,zb,Ab,Bb,Cb,Db,Eb,Fb,Gb,Hb,Ib,Jb,Kb,Lb,Mb,Nb,Ob,Pb,Qb,Rb,Sb,Tb,Ub,Vb,Wb,Xb,Yb,Zb,$b,_b,ac,bc,cc,dc,ec,fc,gc,hc,ic,jc,kc,lc,mc,nc,oc,pc,qc,rc,sc,tc,uc,vc,wc,xc,yc,zc,Ac,Bc,Cc,Dc,Ec,Fc,Gc,Hc,Ic,Jc,Kc,Lc,Mc,Nc,Oc,Pc,Qc,Rc,Sc,Tc,Uc,Vc,Wc,Xc,Yc,Zc,$c,_c,ad,bd,cd=this,dd={activeColumns:[],aggregatorsByColumnId:{},columnPosLeft:[],columnPosRight:[],columnsById:{},indexById:{},nodes:{},postprocess:{},rowPositions:{},rows:[]},ed=0,fd=0,gd=this.NAME+"-alert",hd=this.NAME+"-cell",id=this.NAME+"-clipboard",jd="collapsed",kd=this.NAME+"-column-name",ld=this.NAME+"-contextmenu",md=this.NAME+"-dropdown",nd=md+"-menu",od=md+"-item",pd=md+"-divider",qd=md+"-arrow",rd=md+"-icon",sd=md+"-left",td="expanded",ud=this.NAME+"-group",vd=this.NAME+"-group-title",wd=this.NAME+"-group-toggle",xd=this.NAME+"-resizable-handle",yd=this.NAME+"-header",zd=this.NAME+"-header-columns",Ad=this.NAME+"-header-column",Bd=this.NAME+"-header-column-active",Cd=this.NAME+"-header-column-dragging",Dd=this.NAME+"-header-column-sorted",Ed=this.NAME+"-header-filter",Fd=this.NAME+"-header-filter-cell",Gd="sortable",Hd="invalid",Id=this.NAME+"-no-right",Jd=this.NAME+"-sortable-placeholder",Kd=this.NAME+"-range-decorator",Ld=this.NAME+"-row",Md=this.NAME+"-row-drag-container",Nd=this.NAME+"-row-handle",Od=this.NAME+"-row-total",Pd=this.NAME+"-sort-indicator",Qd=Pd+"-asc",Rd=Pd+"-desc",Sd=this.NAME+"-tooltip",Td=this.NAME+"-tooltip-arrow",Ud=this.NAME+"-viewport",Vd=this.NAME+"-canvas",Wd=0,Xd=null,Yd=!1,Zd=null,$d=null,_d=null,ae=0,be=0,ce="id",de="function"==typeof window.Blob,ee=!1,fe=0,ge=0,he=function(a){this.__nonDataRow=!0,a&&b.extend(this,a)},ie=0,je=0,ke=null,le=null,me=0,ne=0,oe=!1,pe=null,qe=null,re=0,se=0,te=1,ue=this.NAME+"-"+Math.round(1e6*Math.random()),ve=1;he.prototype.toString=function(){return"NonDataItem"},this.options=b.extend({activeFollowsPage:!1,activateSelection:!0,addRow:!1,asyncEditorLoadDelay:100,asyncEditorLoading:!1,asyncPostRenderDelay:25,autoColumnWidth:!1,autoDestroy:!0,autoEdit:!0,"class":null,clipboard:"csv",columns:[],ctrlSelect:!0,data:[],dataExtractor:null,columnWidth:80,editable:!1,editor:null,emptyNotice:!0,exportFileName:"doby-grid-export",formatter:null,fullWidthRows:!0,groupable:!0,headerMenu:!0,keyboardNavigation:!0,lineHeightOffset:-1,locale:{column:{add_group:'Add Grouping By "{{name}}"',add_sort_asc:'Add Sort By "{{name}}" (Ascending)',add_sort_desc:'Add Sort By "{{name}}" (Descending)',aggregators:"Aggregators",deselect:"Deselect Column",filter:'Quick Filter on "{{name}}"',group:'Group By "{{name}}"',grouping:"Grouping",groups_clear:"Clear All Grouping",groups_collapse:"Collapse All Groups",groups_expand:"Expand All Groups",remove:'Remove "{{name}}" Column',remove_group:'Remove Grouping By "{{name}}"',remove_sort:'Remove Sort By "{{name}}"',select:"Select Column",sorting:"Sorting",sort_asc:'Sort By "{{name}}" (Ascending)',sort_desc:'Sort By "{{name}}" (Descending)'},empty:{"default":"No data available",remote:"No results found",filter:"No items matching that filter"},global:{auto_width:"Automatically Resize Columns",columns:"Columns","export":"Export",export_csv:"Export Table to CSV",export_html:"Export Table to HTML",hide_filter:"Hide Quick Filter"}},nestedAggregators:!0,multiColumnSort:!0,quickFilter:!1,remoteScrollTime:200,resizableColumns:!0,resizableRows:!1,resizeCells:!1,reorderable:!0,rowHeight:28,selectable:!0,selectedClass:"selected",shiftSelect:!0,tooltipType:"popup",virtualScroll:!0},a);var we={cache:!1,"class":null,comparator:null,editable:null,focusable:!0,groupable:!0,headerClass:null,id:null,maxWidth:null,minWidth:42,name:"",postprocess:null,removable:!1,rerenderOnResize:!1,resizable:!0,selectable:!0,sortable:!0,sortAsc:!0,tooltip:null,visible:!0,width:null};return b.extend(this,Backbone.Events),this._event=null,this.active=null,this.selection=null,this.sorting=[],Sb=function(){return Yc(),X(),Uc(),cd.collection=new E(cd),cd.options.addRow&&Tb(),K(),cd.options.selectable&&q(),cd},this.activate=function(a,b){if(ee){if(void 0===a||void 0===b)return zc(),void 0;if(!(a>kb()||0>a||b>=dd.activeColumns.length||0>b)&&u(a,b))return Bc(a,b,!1),Gc(bb(a,b),!1),this}},this.add=function(a,b){return this.collection.add(a,b),this},this.addColumn=function(a,c){if(!a||"object"!=typeof a||b.isArray(a)||a instanceof HTMLElement)throw new Error("Unable to addColumn() because the given 'data' param is invalid.");c=c||{};var d=dd.columnsById[a.id];if(void 0!==d){if(c.merge!==!0){var e=["Unable to addColumn() because a column with id '"+a.id];throw e.push("' already exists. Did you want to {merge: true} maybe?"),new Error(e.join(""))}for(var f=0,g=this.options.columns.length;g>f;f++)this.options.columns[f].id==a.id&&b.extend(this.options.columns[f],a);return this}var h=this.options.columns;return null===c.at||void 0===c.at?h.push(a):h.splice(h,c.at,a),cd.setColumns(h),this},this.addGrouping=function(a,b){if(!cd.options.groupable)throw new Error('Cannot execute "addGrouping" because "options.groupable" is disabled.');if(b=b||{},null===a||void 0===a)throw new Error("Unable to add grouping to grid because the 'column_id' value is missing.");return Qb(a)||(b.column_id=a,this.collection.groups.push(b),this.setGrouping(this.collection.groups)),this},l=function(a){this.aggregators=a,this.class=Od,this.columns={},this.editable=!1,this.focusable=!0,this.selectable=!1},l.prototype=new he,l.prototype.toString=function(){return"Aggregate"},l.prototype.exporter=function(a){if(this.aggregators[a.id]){var b;for(var c in this.aggregators[a.id])if(b=this.aggregators[a.id][c],b.active&&b.exporter)return b.exporter()}return""},l.prototype.formatter=function(a,b,c,d){if(this.aggregators[d.id]){var e;for(var f in this.aggregators[d.id])if(e=this.aggregators[d.id][f],e.active&&e.formatter)return e.formatter()}return""},this.appendTo=function(a){if(!a||!a.length)throw new Error('Doby Grid requires a valid container. "'+b(a).selector+'" does not exist in the DOM.');this.$el.appendTo(a);try{ee=!0,bd=parseFloat(b.css(this.$el[0],"width",!0)),dc(),P(e),vc(),Kc(),J(),s(),Ac(),oe&&(nc(function(){0===i[0].scrollTop&&oc()}),this.on("viewportchanged",function(){oc()})),this.$el.on("resize."+this.NAME,Ac),this.options.autoDestroy&&this.$el.one("remove",function(){cd.destroy()}),i.on("scroll",Ob),g.on("contextmenu",Lb).on("click",Mb),"title"!=cd.options.tooltipType&&g.on("mouseover",function(a){Mc(a)}),d.on("keydown",Nb).on("click",Ib).on("dblclick",Kb).on("contextmenu",Jb).on("mouseenter",function(){var a=document.activeElement;a==this||b(this).has(b(a)).length||b(this).focus()}),this.options.resizableRows&&r()}catch(c){console.error&&console.error(c)}return this.options.headerMenu&&this.on("headercontextmenu",Rc),b(window).on("resize",Pb),this},m=function(a){if(ee){a||(a=e.children());var c=null;void 0!==f&&(c=f.children());var d,g,h,i;for(d=0,g=a.length;g>d;d++)h=dd.activeColumns[d].width-ae,i=["width:",h,"px"].join(""),b(a[d]).attr("style",i),c&&c[d]&&b(c[d]).attr("style",i);Uc()}},n=function(){var a,b,c,d,e,f,g=-1;for(d=0,e=dd.activeColumns.length;e>d;d++)a=dd.activeColumns[d],b=a.width,c=eb(d),c.left.style.left=g+"px",f=w-g-b-2,d+1===e&&0>f&&!ad&&(f=0),c.right.style.right=f+"px",g+=a.width+1},o=function(){for(var a=kb(),c=function(){var a=dd.columnsById[this.id];this.cache&&(dd.postprocess[e][a]=b(k).html())};le>=ke;){var d,e=ve>=0?ke++:le--,f=dd.nodes[e];if(f&&!(e>=a)){dd.postprocess[e]||(dd.postprocess[e]={}),R(e);for(d in f.cellNodesByColumnIdx)if(f.cellNodesByColumnIdx.hasOwnProperty(d)){d=d||0;var g=dd.activeColumns[d],h=g.postprocess,i=dd.rows[e],j=i.columns;if(j&&j[d]&&j[d].postprocess&&(h=j[d].postprocess),h&&!dd.postprocess[e][d]){var k=f.cellNodesByColumnIdx[d];k&&h({cell:b(k),column:g,data:ib(e),rowIndex:e},c.bind(g))}}return _d=setTimeout(o,cd.options.asyncPostRenderDelay),void 0}}},p=function(){var a,b,c,d,e,f,g=[],h=0,i=0,k=ad?bd-window.scrollbarDimensions.width:bd;for(k-=dd.activeColumns.length,a=0;a<dd.activeColumns.length;a++)b=dd.activeColumns[a],b.visible!==!1&&(g.push(b.width),i+=b.width,b.resizable&&(h+=b.width-Math.max(b.minWidth||0,j)));for(c=i;i>k&&h;){var l=(i-k)/h;for(a=0;a<dd.activeColumns.length&&i>k;a++){b=dd.activeColumns[a];var n=g[a];if(!(b.visible===!1||!b.resizable||n<=(b.minWidth||0)||j>=n)){var o=Math.max(b.minWidth,j),p=Math.floor(l*(n-o))||1;p=Math.min(p,n-o),i-=p,h-=p,g[a]-=p}}if(i>=c)break;c=i}for(c=i;k>i;){for(d=k/i,a=0;a<dd.activeColumns.length&&k>i;a++)b=dd.activeColumns[a],b.visible===!1||!b.resizable||b.maxWidth&&b.maxWidth<=b.width||(e=1e6,b.maxWidth&&b.maxWidth-b.width&&(e=b.maxWidth-b.width),f=Math.min(Math.floor(d*b.width)-b.width,e)||1,i+=f,g[a]+=f);if(c>=i)break;c=i}var q,r=!1;for(a=0;a<dd.activeColumns.length;a++)q=dd.activeColumns[a],q.visible!==!1&&(!r&&q.rerenderOnResize&&q.width!=g[a]&&(r=!0),dd.activeColumns[a].width=g[a]);m(),Sc(!0),r&&(Vb(),tc())},q=function(){var a=new y,c=null;d.on("draginit",function(a){a.stopImmediatePropagation(),D()}).on("dragstart",function(d,e){var f=$(d);if(f&&(v(f.row,f.cell)&&(c=!0,d.stopImmediatePropagation()),c)){var g=ab(e.startX-b(this).offset().left,e.startY-b(this).offset().top);return e._range={end:g,start:g},a.show(new kc(g.row,g.cell))}}).on("drag",function(d,e){if(c){d.stopImmediatePropagation();var f=ab(d.pageX-b(this).offset().left,d.pageY-b(this).offset().top);v(f.row,f.cell)&&(e._range.end=f,a.show(new kc(e._range.start.row,e._range.start.cell,f.row,f.cell)),cd.options.activateSelection&&u(f.row,f.cell)&&Gc(bb(f.row,f.cell),!1))}}).on("dragend",function(b,d){c&&(c=!1,b.stopImmediatePropagation(),a.hide(),cd._event=b,b.shiftKey||O(),cd.selectCells(d._range.start.row,d._range.start.cell,d._range.end.row,d._range.end.cell,b.shiftKey),cd._event=null,cd.options.activateSelection&&bc())})},r=function(){d.on("dragstart",function(a,c){b(a.target).hasClass(Nd)&&(a.stopImmediatePropagation(),c._row=sb(b(a.target).parent()[0]),c._rowNode=dd.nodes[c._row].rowNode,c._rowsBelow=[],b(c._rowNode).siblings().each(function(){var a=sb(this);a>c._row&&c._rowsBelow.push(this)}),b(c._rowsBelow).wrapAll('<div class="'+Md+'"></div>'),c._container=b(c._rowsBelow).parent())}).on("drag",function(a,c){if(void 0!==c._row){var d=c._rowNode,e=dd.rowPositions[c._row],f=e.height||cd.options.rowHeight;c._height=f+c.deltaY,c._height<5&&(c._height=5),b(d).height(c._height),b(d).css("line-height",c._height+cd.options.lineHeightOffset+"px"),c._container.css({marginTop:c._height-f+"px"})}}).on("dragend",function(a,c){void 0!==c._row&&(b(c._rowsBelow).unwrap(),Hc(c._row,c._height))})},s=function(a,b){a=a||0,0===a&&(dd.indexById={},!b&&Zc&&(dd.rowPositions={0:{top:0,height:cd.options.rowHeight,bottom:cd.options.rowHeight}}));for(var c,d,e=a,f=dd.rows.length;f>e;e++)c=dd.rows[e],dd.indexById[c[ce]]=e,!b&&Zc&&(d={top:dd.rowPositions[e-1]?dd.rowPositions[e-1].bottom-ie:0},d.top+=0===e?0:1,c.height&&c.height!=cd.options.rowHeight&&(d.height=c.height),d.bottom=d.top+(d.height||cd.options.rowHeight),dd.rowPositions[e]=d)},t=function(){if(Zc){var a=i[0].scrollTop,b=tb($c+a);hc=b-tb(a)}else hc=Math.floor($c/(cd.options.rowHeight+1))},u=function(a,b){if(!cd.options.keyboardNavigation||a>=kb()||0>a||b>=dd.activeColumns.length||0>b)return!1;var c=cd.collection.getItem(a);if("boolean"==typeof c.focusable)return c.focusable;var d=c.columns;return d&&d[dd.activeColumns[b].id]&&"boolean"==typeof d[dd.activeColumns[b].id].focusable?d[dd.activeColumns[b].id].focusable:d&&d[b]&&"boolean"==typeof d[b].focusable?d[b].focusable:dd.activeColumns[b].focusable},v=function(a,b){if(a>=kb()||0>a||b>=dd.activeColumns.length||0>b)return!1;var c=cd.collection.getItem(a);if("boolean"==typeof c.selectable)return c.selectable;var d=c.columns&&(c.columns[dd.activeColumns[b].id]||c.columns[b]);return d&&"boolean"==typeof d.selectable?d.selectable:dd.activeColumns[b].selectable},x=function(a,b){return!(0>a||a>=kb()||0>b||b>=dd.activeColumns.length)},y=function(){this.$el=null,this.show=function(a){this.$el||(this.$el=b('<div class="'+Kd+'"></div>').appendTo(d));var c=cb(a.fromRow,a.fromCell),e=cb(a.toRow,a.toCell),f=parseInt(this.$el.css("borderBottomWidth"),10),g=parseInt(this.$el.css("borderLeftWidth"),10),h=parseInt(this.$el.css("borderRightWidth"),10),i=parseInt(this.$el.css("borderTopWidth"),10);return c&&e&&this.$el.css({top:c.top,left:c.left,height:e.bottom-c.top-f-i,width:e.right-c.left-g-h}),this.$el},this.hide=function(){this.$el&&(this.$el.remove(),this.$el=null)}},A=function(a){for(var b,c,d,e=[],f=[],g=0,h=a.top,i=a.bottom;i>=h;h++)if(b=dd.nodes[h]){R(h),B(a,h),c=0;for(var j=cd.collection.getItem(h),k=j.columns,l=ib(h),m=0,n=dd.activeColumns.length;n>m&&!(dd.columnPosLeft[m]>a.rightPx);m++)if(null===(d=b.cellColSpans[m])){if(d=1,k){var o=k[dd.activeColumns[m].id]||k[m];d=o&&o.colspan||1,"*"===d&&(d=n-m)}dd.columnPosRight[Math.min(n-1,m+d-1)]>a.leftPx&&(uc(e,h,m,d,l),c++),m+=d>1?d-1:0}else m+=d>1?d-1:0;c&&(g+=c,f.push(h))}if(e.length){var p=document.createElement("div");p.innerHTML=e.join("");for(var q,r;null!==(q=f.pop());){b=dd.nodes[q];for(var s;null!==(s=b.cellRenderQueue.pop());)r=p.lastChild,b.rowNode.appendChild(r),b.cellNodesByColumnIdx[s]=r}}},B=function(a,b){var c=0,d=dd.nodes[b],e=[];for(var f in d.cellNodesByColumnIdx)if(d.cellNodesByColumnIdx.hasOwnProperty(f)){f=0|f;var g=d.cellColSpans[f];(dd.columnPosLeft[f]>a.rightPx||dd.columnPosRight[Math.min(dd.activeColumns.length-1,f+g-1)]<a.leftPx)&&(!cd.active||b==cd.active.row&&f==cd.active.cell||e.push(f))}for(var h;null!==(h=e.pop())&&h;)d.rowNode.removeChild(d.cellNodesByColumnIdx[h]),delete d.cellColSpans[h],delete d.cellNodesByColumnIdx[h],dd.postprocess[b]&&delete dd.postprocess[b][h],c++},C=function(a){var b=cd.active&&"row"in cd.active?cd.active.row:null;for(var c in dd.nodes)(c=parseInt(c,10))!==b&&(c<a.top||c>a.bottom)&&sc(c)},D=function(){if(document.selection&&document.selection.empty)try{document.selection.empty()}catch(a){}else if(window.getSelection){var b=window.getSelection();b&&b.removeAllRanges&&b.removeAllRanges()}},H=function(){if(!cd.active||!Xd)return!0;var a=ib(cd.active.row),c=dd.activeColumns[cd.active.cell],d=function(){b(cd.active.node).removeClass(Hd).width(),b(cd.active.node).addClass(Hd),cd.trigger("validationerror",cd._event,{editor:Xd,cellNode:cd.active.node,validationResults:e,row:cd.active.row,cell:cd.active.cell,column:c}),Xd.focus()};if(Xd.isValueChanged()){var e=Xd.validate();if(e.valid){if(a.__addRow){var f={data:{}};if(Xd.applyValue(f,Xd.serializeValue()),!f.data.id&&!f.id||f.id in dd.indexById||f.data.id in dd.indexById)return e={valid:!1,msg:"Unable to create a new item without a unique 'id' value."},d(),void 0;cd.add(f),cd.trigger("newrow",cd._event,{item:f,column:c})}else cd.selection,Xd.applyValue(a,Xd.serializeValue()),Vc(cd.active.row),cc(),cd.trigger("change",cd._event,{row:cd.active.row,cell:cd.active.cell,item:a});return!0}return d(),!1}return cc(),!0},I=function(){var a;if(cd.selection&&("csv"==cd.options.clipboard?a=cd.selection[0].toCSV():"json"==cd.options.clipboard&&(a=JSON.stringify(cd.selection[0].toJSON()))),!a&&cd.active&&cd.active.node){var c=sb(cd.active.node.parentNode),d=_(cd.active.node),e=dd.rows[c],f=dd.activeColumns[d];a=vb(e,f)}a&&b('<textarea class="'+id+'"></textarea>').val(a).appendTo(cd.$el).focus().select().on("keyup",function(){b(this).remove()})},J=function(){h=b('<style type="text/css" rel="stylesheet"></style>').appendTo(b("head"));for(var a=cd.options.rowHeight-ed,c=["#"+ue+" ."+Ld+"{height:"+a+"px;line-height:"+(a+cd.options.lineHeightOffset)+"px}"],d=0,e=dd.activeColumns.length;e>d;d++)c.push("#"+ue+" .l"+d+"{}"),c.push("#"+ue+" .r"+d+"{}");h[0].appendChild(document.createTextNode(c.join("\n")))},K=function(){var a=[cd.NAME];cd.options.class&&a.push(cd.options.class),cd.$el=b('<div class="'+a.join(" ")+'" id="'+ue+'"></div>'),g=b('<div class="'+yd+'"></div>').appendTo(cd.$el),e=b('<div class="'+zd+'"></div>').appendTo(g).width(nb()),i=b('<div class="'+Ud+'"></div>').appendTo(cd.$el),d=b('<div class="'+Vd+'" tabindex="0"></div>').appendTo(i)},L=function(a){if(!a)throw new Error("Unable to create group because grouping object is missing.");if(void 0===a.column_id)throw new Error("Unable to create grouping object because 'column_id' is missing.");var c=db(a.column_id),d=b.extend({collapsed:!0,column_id:c.id,comparer:function(a,b){return fc(a.value,b.value)},formatter:function(a){var b=["<strong>"+c.name+":</strong> ",null===a.value?"-empty-":a.value,' <span class="count">(<strong>'+a.count+"</strong> item"];return 1!==a.count&&b.push("s"),b.push(")</span>"),b.join("")},getter:function(a){return jb(a,c)},grouprows:[]},a);return d},E=function(a){var d,e,f,g,h,i,j,k,m,n,o,p,q,r,t,u,v=this,w=[],x=[],y=":|:",z=0,A=0,B={},C={},D=null,E=!0,F=!1,G=[],H=0,I=null;return b.extend(this,Backbone.Events),this.items=[],this.filter=null,this.groups=[],this.length=0,this.initialize=function(){return!oe&&a.options.data&&this.reset(a.options.data),this},this.add=function(b,d){c.isArray(b)||(b=b?[b]:[]),d=d||{};var e,f,g=d.at,h=[];n(b);for(var i=0,j=b.length;j>i;i++)if(e=b[i],f=this.get(e),oe&&void 0!==g&&this.items[g+i]instanceof jc&&(f=this.items[g+i]),f){if(!d.merge)throw["You are not allowed to add() items without a unique 'id' value. ","A row with id '"+f[ce]+"' already exists."].join("");this.setItem(f[ce],e)}else h.push(e);if(h.length)if(a.options.emptyNotice&&1==this.items.length&&this.items[0].__alert&&this.remove(this.items[0][ce]),!a.options.addRow||!(g&&g>this.items.length||null===g||void 0===g)||"__addRow"in h[0]||(g=this.items.length-1),this.items instanceof Backbone.Collection)this.items.add(h);else if(null!==g&&void 0!==g)Array.prototype.splice.apply(this.items,[g,0].concat(h)),s(g>0?g-1:0);else{var k=this.items.length;Array.prototype.push.apply(this.items,h),s(k>0?k-1:0)}return d.silent||this.refresh(),this},this.collapseAllGroups=function(a){d(a,!0)},this.collapseGroup=function(){var a=Array.prototype.slice.call(arguments),b=a[0];1==a.length&&-1!=b.indexOf(y)?f(b.split(y).length-1,b,!0):f(a.length-1,a.join(y),!0)},this.expandAllGroups=function(a){d(a,!1)},d=function(a,b){if(null===a||void 0===a)for(var c=0,d=v.groups.length;d>c;c++)G[c]={},v.groups[c].collapsed=b;else G[a]={},v.groups[a].collapsed=b;v.refresh(),oe&&!b&&oc()},f=function(a,b,c){G[a][b]=v.groups[a].collapsed^c,v.refresh(),oe&&!c&&oc()},this.expandGroup=function(){var a=Array.prototype.slice.call(arguments),b=a[0];1==a.length&&-1!=b.indexOf(y)?f(b.split(y).length-1,b,!1):f(a.length-1,a.join(y),!1)},R=function(a){var c=dd.nodes[a];if(c&&c.cellRenderQueue.length)for(var d=b(c.rowNode).children("."+hd).last()[0];c.cellRenderQueue.length;){var e=c.cellRenderQueue.pop();c.cellNodesByColumnIdx[e]=d,d=d.previousSibling}},g=function(a,b,c){var d,e,f,h,i,j,k,m=[],n={},o=b?b.level+1:0,p=v.groups[o],q=function(q){var r=function(a){var c=new Gb,d=a?a.value:e;return c.collapsed=p.collapsed,a&&(c.count=a.count),c.value=d,c.level=o,c.predef=p,c.id="__group"+(b?b.id+y:"")+d,p.grouprows.push(c),c};if(q)for(p.grouprows=[],h=0,i=q.length;i>h;h++)d=r(q[h]),m.push(d),n[q[h].value]=d;for(h=0,i=a.length;i>h;h++)if(f=a[h],f instanceof l&&f.__gridAggregate)j=f;else if(f.__addRow)k=f;else{if(f instanceof jc||(e="function"==typeof p.getter?p.getter(f):f[p.getter],d=n[e],d||(d=r(),m.push(d),n[e]=d)),f instanceof jc){for(var s=0,t=m.length;t>s;s++)if(m[s].count>m[s].grouprows.length){m[s].grouprows.push(f);break}}else d.grouprows.push(f);q||d.count++}if(o<v.groups.length-1){var u=function(a){d.groups=a};for(h=0,i=m.length;i>h;h++)d=m[h],d instanceof l||g(d.grouprows,d,u)}q||m.sort(v.groups[o].comparer),k&&m.push(k),j&&m.push(j),c(m)};oe?pc(function(a){q(a)}):q()},h=function(b,d){d=d||0;for(var e,f=v.groups[d],g=G[d],i=b.length,j=function(a){return a instanceof l};i--;)e=b[i],e.collapsed=f.collapsed^g[e.id],e.title=f.formatter?f.formatter(e):e.value,e.groups&&(h(e.groups,d+1),e.grouprows=a.options.nestedAggregators?c.filter(e.grouprows,j):[])},i=function(b,c){c=c||0;for(var d,e,f=[],g=0,h=0,j=b.length;j>h;h++)if(e=b[h],f[g++]=e,!e.collapsed){if(d=e.groups?i(e.groups,c+1):e.grouprows,!d)continue;for(var k=0,m=d.length;m>k;k++)f[g++]=d[k];a.options.nestedAggregators&&e.groups&&1===e.grouprows.length&&e.grouprows[0]instanceof l&&(f[g++]=e.grouprows[0])}return f},j=function(a){if(a=a instanceof Backbone.Collection?a.models:a,v.filter){var b=r,c=t;C.isFilterNarrowing?x=b(x):C.isFilterExpanding?x=c(a,w):C.isFilterUnchanged||(x=b(a))}else x=A?a:a.concat();var d;return A?(x.length<z*A&&(z=Math.floor(x.length/A)),d=x.slice(A*z,A*z+A)):d=x,{totalRows:x.length,rows:d}},this.getItem=function(a){return dd.rows[a]},this.get=function(a){if(null===a)return void 0;var b=a;return"object"!=typeof a||(b=a[ce]||a.data[ce])?this.items[dd.indexById[b]]:null},k=function(a,b){var c,d,e,f=[],g=0,h=b.length;C&&C.ignoreDiffsBefore&&(g=Math.max(0,Math.min(b.length,C.ignoreDiffsBefore))),C&&C.ignoreDiffsAfter&&(h=Math.min(b.length,Math.max(0,C.ignoreDiffsAfter)));for(var i=g,j=a.length;h>i;i++)i>=j?f[f.length]=i:(c=b[i],d=a[i],e=c&&c.__nonDataRow||d&&d.__nonDataRow,c&&d&&(c instanceof Gb&&!(d instanceof Gb)||!(c instanceof Gb)&&d instanceof Gb||v.groups.length&&e&&c&&c instanceof Gb&&c[ce]!=d[ce]||c&&c instanceof Gb&&c.collapsed!=d.collapsed||e&&(c instanceof l||d instanceof l)||c&&c[ce]!=d[ce]||I&&I[c[ce]])&&(f[f.length]=i));return f},m=function(a){var b=new he({__alert:!0,id:"-empty-alert-message-",selectable:!1,focusable:!1,"class":gd,columns:{0:{colspan:"*",formatter:function(){return ob("empty.default")},editor:null}}});a.push(b)},n=function(b){b=b instanceof Backbone.Collection?b.models:b;var c,d,e,f;for(c=0,d=b.length;d>c;c++){if(f=b[c],void 0===f[ce]||null===f[ce])throw"Each data item must have a unique 'id' key. The following item is missing an 'id': "+JSON.stringify(f);if(f.rows)for(var g in f.rows){if(e=f.rows[g],!Zc&&e.height&&e.height!=a.options.rowHeight){Zc=!0;break}if(e.columns&&!Yd)for(var h in e.columns){if(Yd)break;e.columns[h].postprocess&&(Yd=!0)}}if(!Zc&&f.height&&f.height!==a.options.rowHeight&&(Zc=!0),f.columns&&!Yd)for(var i in f.columns){if(Yd)break;f.columns[i].postprocess&&(Yd=!0)}}return b},o=function(){var a,b,c,d;for(b=0,c=v.items.length;c>b;b++)if(a=v.items instanceof Backbone.Collection?v.items.at(b):v.items[b],!(a instanceof l))for(var e in dd.aggregatorsByColumnId){d=null;for(var f in dd.aggregatorsByColumnId[e]){if("function"!=typeof dd.aggregatorsByColumnId[e][f].process)throw new Error('The column aggregator for "'+e+"\" is missing a valid 'process' function.");null===d&&dd.aggregatorsByColumnId[e][f].active&&(d=f),dd.aggregatorsByColumnId[e][f].process(a)}null===d&&(d=0,dd.aggregatorsByColumnId[e][d].active=!0)}var g=new l(dd.aggregatorsByColumnId);g.__gridAggregate=!0,v.items instanceof Backbone.Collection?v.items.models.push(g):v.items.push(g)},p=function(a){var b,c,d,e,f,g,h,i,j;for(b=0,c=a.length;c>b;b++)if(d=a[b],d instanceof Gb){d.aggregators={};for(g in dd.aggregatorsByColumnId){f=db(g),d.aggregators[g]={};for(j in dd.aggregatorsByColumnId[g])d.aggregators[g][j]=new f.aggregators[j].fn(f),dd.aggregatorsByColumnId[g][j].active&&(d.aggregators[g][j].active=!0)}for(h=0,i=a[b].grouprows.length;i>h;h++){e=a[b].grouprows[h];for(g in d.aggregators)for(j in d.aggregators[g])d.aggregators[g][j].process(e)}d.grouprows.push(new l(d.aggregators)),d.groups&&d.groups.length&&p(d.groups)}},q=function(a,b){D=null,(C.isFilterNarrowing!=B.isFilterNarrowing||C.isFilterExpanding!=B.isFilterExpanding)&&(w=[]);var c=j(a);H=c.totalRows;var d=c.rows,e=function(){for(var a,c=0,e=0,f=d.length;f>e;e++)if(d[e].rows)for(var g in d[e].rows)d[e].rows[g].collapsed||(a=new he(d[e].rows[g]),a.parent=d[e],d.splice(e+c+1,0,a),c++);var h=k(dd.rows,d);dd.rows=d,h.length&&s(0),b(h)},f=[];v.groups.length?g(d,null,function(a){f=a,f.length&&(Object.keys(dd.aggregatorsByColumnId).length&&p(f),h(f),d=i(f)),e()}):e()},this.refresh=function(){if(!F){var a,b=dd.rows.length,c=function(){I=null,B=C,C={},this.length=dd.rows.length,b!=dd.rows.length&&(Wc(),this.trigger("onRowCountChanged",{},{previous:b,current:dd.rows.length})),a.length>0&&(Yb(a),tc(),this.trigger("onRowsChanged",{},{rows:a}))}.bind(this);q(this.items,function(b){a=b,A&&z*A>H?(z=Math.max(0,Math.ceil(H/A)-1),q(this.items,function(b){a=b,c()})):c()}.bind(this))}},this.remove=function(a){if(void 0===a||null===a)throw new Error("Unable to delete collection item. Invalid 'id' supplied.");var b=dd.indexById[a];if(null===b||void 0===b)throw new Error(["Unable to remove row '",a,"' because no such row could be found in the grid."].join(""));this.items instanceof Backbone.Collection?this.items.remove(a):this.items.splice(b,1),delete dd.indexById[a],delete dd.rowPositions[b],s(b),this.refresh()},this.reset=function(a,b){a||(a=[]),F=!0,b&&(dd.rows=[]),n(a),this.items=x=u(a),Object.keys(dd.aggregatorsByColumnId).length&&o(),b&&s(),F=!1,this.refresh()},this.setGrouping=function(c){if(!a.options.groupable)throw new Error('Cannot execute "setGrouping" because "options.groupable" is disabled.');if(c=c||[],!b.isArray(c))throw new Error("Unable to set grouping because given options are not an array. Given: "+JSON.stringify(c));c.length||(G=[]),dd.remoteGroups&&(dd.remoteGroups=null);var d,e,f,g=[];for(d=0,e=c.length;e>d;d++){if(f=db(c[d].column_id),void 0===f)throw new Error('Cannot add grouping for column "'+c[d].column_id+'" because no such column could be found.');if(f.groupable===!1)throw new Error('Cannot add grouping for column "'+f.id+'" because "options.groupable" is disabled for that column.');G[d]||(G[d]={}),g.push(L(c[d]))}this.groups=g,oe&&V(),this.refresh(),oe&&0===g.length&&oc()},this.setItem=function(a,d){if(void 0===dd.indexById[a])throw new Error("Unable to update item (id: "+a+"). Invalid or non-matching id");var e=dd.indexById[a];if(dd.rows[e]=dd.rows[e]instanceof jc||this.items[f]instanceof Backbone.Model?d:b.extend(!0,dd.rows[e],d),dd.indexById[d.id]=e,this.items instanceof Backbone.Collection)this.items.set(d,{add:!1,remove:!1});else for(var f=0,g=this.items.length;g>f;f++)if(this.items[f].id==a){this.items[f]=this.items[f]instanceof jc?d:b.extend(!0,this.items[f],d);break}d.rows&&Yb(c.range(e,dd.rows.length)),I||(I={}),I[a]=!0,this.refresh()},this.sort=function(a,b){E=b,e=a,b===!1&&this.items.reverse(),this.items instanceof Backbone.Collection?(this.items.comparator=a,this.items.sort()):this.items.sort(a),b===!1&&this.items.reverse(),s(null,!0),this.refresh()},r=function(a){for(var b=[],c=0,d=0,e=a.length;e>d;d++)v.filter(a[d])&&(b[c++]=a[d]);return b},t=function(a,b){for(var c,d=[],e=0,f=0,g=a.length;g>f;f++)c=a[f],b[f]?d[e++]=c:v.filter(c)&&(d[e++]=c,b[f]=!0);return d},u=function(b){return a.options.emptyNotice&&!b.length&&m(b),b},this.initialize()},M=function(a){return this.initialize=function(){this.loadValue(a.item);var c=this.currentValue;(null===c||void 0===c)&&(c=""),this.$input=b('<input type="text" class="editor" value="'+c+'"/>').appendTo(a.cell).on("keydown",function(a){if([9,13,33,34,35,36].indexOf(a.which)>=0)return a.preventDefault(),void 0;if(27!=a.which){var c=Z(this);(null===c&&38!=a.which&&40!=a.which||c>0&&37===a.which||c<b(this).val().length&&39===a.which)&&a.stopImmediatePropagation()}}).focus().select()},this.applyValue=function(b,c){"id"in b||"id"!=a.column.field||(b.id=c),b.data[a.column.field]=c},this.cancel=function(){cc()},this.destroy=function(){this.$input.remove()},this.focus=function(){this.$input.focus()},this.getValue=function(){return this.$input.val()},this.isValueChanged=function(){return!(""===this.$input.val()&&null===this.currentValue)&&this.$input.val()!=this.currentValue},this.loadValue=function(b){return b&&b.data?(this.currentValue=b.data[a.column.field]||null,this.currentValue):null},this.serializeValue=function(){return this.$input.val()},this.setValue=function(a){this.$input.val(a)},this.validate=function(){var b=this.getValue();if(a.column.validator){var c=a.column.validator(b);if(!c.valid)return c}return{valid:!0,msg:null}},this.initialize()},N=function(a,b,c){return void 0===c||null===c?"":(c+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},O=function(a,b){if(cd.selection){for(var c=void 0!==a&&null!==a&&void 0!==b&&null!==b,d=0,e=cd.selection.length;e>d;d++)c?cd.selection[d].contains(a,b)&&cd.selection[d].deselect(a,b):cd.selection[d].deselect();if(c||(cd.selection=null),cd.selection){var f=[];for(d=0,e=cd.selection.length;e>d;d++)cd.selection[d].fullyExcluded()||f.push(cd.selection[d]);cd.selection=0===f.length?null:f}}},this.destroy=function(){this.options.reorderable&&e.filter(":ui-sortable").sortable("destroy"),this.$el&&this.$el.length&&(this.$el.unbind("remove"),this.$el.remove(),this.$el=null),qc(),b(window).off("resize",Pb)},P=function(a){a&&a.jquery&&a.attr("unselectable","on").css("MozUserSelect","none").on("selectstart.ui",function(){return!1})},Q=function(a,c){return this.open=!1,this.initialize=function(){this.$parent=c.parent||b(a.currentTarget),this.$el=c.menu,this.id=[ue,md,c.id].join("_");var d=null;this.$parent.data(md)?(d=this.$parent.data(md).filter(function(a){return a.id==this.id}.bind(this)),d&&(d=d[0])):this.$parent.data(md,[]),d&&d.open?d.hide():(this.$el.attr("id",this.id),this.$el.addClass(["off",md].join(" ")),this.show());var e;return e=function(c){c.target!=a.target&&(this.hide(),b(document).off("click",e),b(document).off("context",e))}.bind(this),b(document).on("click",e),b(document).on("contextmenu",e),this},this.position=function(){var b=a.clientY-this.$parent.offset().top,c=a.clientX-this.$parent.offset().left,d=this.$el.outerWidth(),e=c+d,f=this.$el.parent().width();e>f&&(c-=d),e+d>f&&this.$el.addClass(sd),this.$el.css({left:c,top:b})},this.initialize()},Q.prototype.show=function(){if(!this.open){this.$el.appendTo(this.$parent),this.position();var a=this.$parent.data(md);a.push(this),this.$parent.data(md,a),setTimeout(function(){this.$el.removeClass("off")}.bind(this),150),this.open=!0}},Q.prototype.hide=function(){if(this.open&&this.$parent&&this.$parent.data(md)){var a=this.$parent.data(md).filter(function(a){return a!=this}.bind(this));this.$parent.data(md,a),this.$el.addClass("off"),setTimeout(function(){this.$el.remove()}.bind(this),150),this.open=!1}},S=function(a){var b=a.sortCols;return oe&&!lc()?(V(),dd.rows=[],oc(),void 0):(cd.collection.sort(function(a,c){for(var d,e,f,g,h,i=0,j=0,k=b.length;k>j;j++){if(d=b[j].sortCol,e=d.field,f=b[j].sortAsc?1:-1,a instanceof l)return 1;if(c instanceof l)return-1;if(g=jb(a,d),h=jb(c,d),"function"==typeof d.comparator)return d.comparator(g,h)*f;if(null===g&&null===h)return 0;if(null===g)return 1;if(null===h)return-1;i+=fc(g,h)*f}return i}),void 0)},this.export=function(a){var b=["csv","html"];if(b.indexOf(a)<0)throw new Error('Sorry, "'+a+'" is not a supported format for export.');var c,d,e,f,g,h,i=[];"html"===a&&i.push("<table><thead><tr>");var j=[];for(c=0,d=dd.activeColumns.length;d>c;c++)h=dd.activeColumns[c].name||"","csv"===a?(h=h.replace(/\"/g,'"'),j.push(['"',h,'"'].join(""))):"html"===a&&(j.push("<th>"),j.push(h),j.push("</th>"));for("csv"===a?i.push(j.join(",")):"html"===a&&(i.push(j.join("")),i.push("</tr></thead><tbody>")),c=0,d=this.collection.items.length;d>c;c++)if(!(this.collection.items[c]instanceof he)){for(e=[],"html"===a&&e.push("<tr>"),f=0,g=dd.activeColumns.length;g>f;f++)h=this.collection.items instanceof Backbone.Collection?vb(this.collection.items.at(c),dd.activeColumns[f]):vb(this.collection.items[c],dd.activeColumns[f]),"csv"===a?(h=null!==h&&void 0!==h?h.toString().replace(/\"/g,'"'):"",e.push(['"',h,'"'].join(""))):"html"===a&&(e.push("<td>"),e.push(h),e.push("</td>"));
"csv"===a?i.push(e.join(",")):"html"===a&&(e.push("</tr>"),i.push(e.join("")))}return"html"===a&&i.push("</tbody></table>"),"csv"===a?i=i.join("\n"):"html"===a&&(i=i.join("")),i},this.filter=function(a){return this.collection.filter=a,this.collection.refresh(),this},T=function(a){for(var b=0;b<dd.activeColumns.length;){if(u(a,b))return b;b+=hb(a,b)}return null},U=function(a){for(var b=0,c=null;b<dd.activeColumns.length;)u(a,b)&&(c=b),b+=hb(a,b);return c},V=function(){cd.collection.items=[];for(var a,b,c=0,d=cd.collection.length;d>c;c++)a="placeholder-"+c,b=new jc({id:a}),cd.collection.items.push(b),dd.indexById[a]=b},this.get=function(a){return this.collection.get(a)},W=function(){return cd.active&&cd.active.node?{row:cd.active.row,cell:cd.active.cell}:null},X=function(){window.maxSupportedCssHeight=window.maxSupportedCssHeight||pb(),window.scrollbarDimensions=window.scrollbarDimensions||ub()},Y=function(){var a,b,c=bd-(ad?window.scrollbarDimensions.width:0),d=0;for(a=0,b=dd.activeColumns.length;b>a;a++)d+=dd.activeColumns[a].width-1;return cd.options.fullWidthRows?Math.max(d,c):d+2*b},Z=function(a){var b=0;if(document.selection){a.focus();var c=document.selection.createRange();c.moveStart("character",-a.value.length),b=c.text.length}else{if(a.selectionStart!==a.selectionEnd)return null;(a.selectionStart||"0"==a.selectionStart)&&(b=a.selectionStart)}return b},_=function(a){var b=/l\d+/.exec(a.className);if(!b)throw"getCellFromNode: cannot get cell - "+a.className;return parseInt(b[0].substr(1,b[0].length-1),10)},ab=function(a,b){for(var c=tb(b),d=0,e=0,f=0,g=dd.activeColumns.length;g>f&&a>e;f++)e+=dd.activeColumns[f].width,d++;return 0>d&&(d=0),{cell:d-1,row:c}},bb=function(a,b){return dd.nodes[a]?(R(a),dd.nodes[a].cellNodesByColumnIdx[b]):null},cb=function(a,b){if(!x(a,b))return null;var c,d;if(Zc){var e=dd.rowPositions[a];c=e.top-1,d=c+(e.height||cd.options.rowHeight)+2}else c=cd.options.rowHeight*a-ie+a-1,d=c+cd.options.rowHeight+2;for(var f=-1,g=0;b>g;g++)f+=dd.activeColumns[g].width+1;var h=f+dd.activeColumns[b].width+2;return{bottom:d,left:f,right:h,top:c}},$=function(a){var c=b(a.target).closest("."+hd,d);if(!c.length)return null;var e=sb(c[0].parentNode),f=_(c[0]);return null===e||null===f?null:{row:e,cell:f}},hb=function(a,b){var c=cd.collection.getItem(a);if(!c.columns)return 1;var d=c.columns[dd.activeColumns[b].id]||c.columns[b],e=d&&d.colspan;return e="*"===e?dd.activeColumns.length-b:e||1},db=function(a){return c.findWhere(cd.options.columns,{id:a})},eb=function(a){if(!Oc){var b,c,d=document.styleSheets;for(b=0,c=d.length;c>b;b++)if((d[b].ownerNode||d[b].owningElement)==h[0]){Oc=d[b];break}if(!Oc)throw new Error("Cannot find stylesheet.");F=[],G=[];var e,f,g=Oc.cssRules||Oc.rules;for(b=0;b<g.length;b++){var i=g[b].selectorText;e=new RegExp(/\.l\d+/).exec(i),e?(f=parseInt(e[0].substr(2,e[0].length-2),10),F[f]=g[b]):(e=new RegExp(/\.r\d+/).exec(i),e&&(f=parseInt(e[0].substr(2,e[0].length-2),10),G[f]=g[b]))}}return{left:F[a],right:G[a]}},fb=function(a){var c=e.children(),f=b(c[a]),g=f.width(),h=parseInt(f.css("paddingLeft"),10)+parseInt(f.css("paddingRight"),10),i=[],j=f.children("."+kd+":first");j.css("overflow","visible"),f.width("auto");var k=f.width()+h+1;return j.css("overflow",""),f.width(g),i.push(k),d.find(".l"+a+".r"+a+":visible").removeClass("r"+a).each(function(){var a=b(this).outerWidth();i.indexOf(a)<0&&i.push(a)}).addClass("r"+a),Math.max.apply(null,i)},gb=function(a){var c=b(a.target).closest("."+Ad+":not(."+Jd+")"),d=c&&c.length?c.attr("id").replace(ue,""):null;return d?db(d):null},ib=function(a){return cd.collection.getItem?cd.collection.getItem(a):cd.collection[a]},jb=function(a,b){return cd.options.dataExtractor?cd.options.dataExtractor(a,b):a instanceof Backbone.Model?a.get(b.field):a instanceof Gb?a.value:a.data?a.data[b.field]:null},kb=function(){return cd.collection?cd.collection.length:0},lb=function(a,b){var c=dd.activeColumns[b],d=cd.collection.getItem(a),e=d.columns;return e&&e[c.id]&&void 0!==e[c.id].editor?e[c.id].editor:e&&e[b]&&void 0!==e[b].editor?e[b].editor:c.editor||cd.options.editor&&cd.options.editor.getEditor(c)||M},mb=function(a,b){var c=cd.collection.getItem(a),d=c.columns&&(c.columns[b.id]||c.columns[dd.columnsById[b.id]]);return c.formatter?c.formatter.bind(c):null||d&&d.formatter||b.formatter||cd.options.formatter||N},nb=function(){for(var a=0,b=0,c=dd.activeColumns.length;c>b;b++)a+=dd.activeColumns[b].width+1;return a+=window.scrollbarDimensions.width,Math.max(a,bd)+1e3},ob=function(a,b){b=b||{};var d=cd.options.locale;if(c.each(a.split("."),function(a){d=d[a]}),!d)throw new Error('Doby Grid does not have a locale string defined for "'+a+'"');return c.template(d,b,{interpolate:/\{\{(.+?)\}\}/gim})},pb=function(){for(var a,c=1e6,d=navigator.userAgent.toLowerCase().match(/firefox/)?6e6:1e9,e=b('<div style="display:none"></div>').appendTo(document.body);;){if(a=2*c,e.css("height",a),a>d||e.height()!==a)break;c=a}return e.remove(),c},qb=function(a,b){var c,d=yb(a,b),e=3;return c=Zc?Math.round(tb($c)):Math.round($c/cd.options.rowHeight),-1==ve?(d.top-=c,d.bottom+=e):1==ve?(d.top-=e,d.bottom+=c):(d.top-=e,d.bottom+=e),d.top=Math.max(0,d.top),d.bottom=Math.min(kb()-1,d.bottom),d.leftPx-=bd,d.rightPx+=bd,d.leftPx=Math.max(0,d.leftPx),d.rightPx=Math.min(w,d.rightPx),d},rb=function(a){var c=b(a.target).closest("."+Ld,d);return c.length?sb(c[0]):null},sb=function(a){for(var b in dd.nodes)if(dd.nodes[b].rowNode===a)return 0|b;return null},tb=function(a){if(!Zc)return Math.floor((a+ie)/(cd.options.rowHeight+1));var b,c,d,e=0,f=dd.rows.length;if(f){for(d=0;f>d;d++)b=dd.rowPositions[d],b.top<=a&&b.bottom>=a&&(e=d);return c=dd.rowPositions[f-1],a>c.bottom&&(e=f-1),e}},ub=function(){var a="position:absolute;top:-10000px;left:-10000px;width:100px;height:100px;overflow:scroll",c=b("<div style='"+a+"'></div>").appendTo(b(document.body)),d={width:c.width()-c[0].clientWidth,height:c.height()-c[0].clientHeight};return c.remove(),d},vb=function(a,b){return"function"==typeof a.exporter?a.exporter(b,a).toString():b.exporter&&"function"==typeof b.exporter?b.exporter(b,a).toString():jb(a,b)},wb=function(a){var c=["borderTopWidth","borderBottomWidth","paddingTop","paddingBottom"],d=0;return b.each(c,function(b,c){d+=parseFloat(a.css(c))||0}),d},xb=function(){return parseFloat(b.css(cd.$el[0],"height",!0))-parseFloat(b.css(cd.$el[0],"paddingTop",!0))-parseFloat(b.css(cd.$el[0],"paddingBottom",!0))-parseFloat(b.css(g[0],"height"))-wb(g)},yb=function(a,b){(void 0===a||null===a)&&(a=se),(void 0===b||null===b)&&(b=re);var c,d;return Zc?(c=Math.floor(tb(a+ie)),d=Math.ceil(tb(a+ie+$c))):(c=tb(a),d=tb(a+$c)+1),{top:c,bottom:d,leftPx:b,rightPx:b+bd}},zb=function(a,b,c){if(ee&&u(a,b)){Bc(a,b,!1);var d=bb(a,b);Gc(d,c||a===kb()||cd.options.autoEdit)}},Ab=function(a,b,c){for(var d,e=kb();;){if(++a>=e)return null;for(d=b=0;c>=b;)d=b,b+=hb(a,b);if(u(a,d))return{row:a,cell:d,posX:c}}},Bb=function(a,b){if(0>=b)return null;var c=T(a);if(null===c||c>=b)return null;for(var d,e={row:a,cell:c,posX:c};;){if(d=Eb(e.row,e.cell,e.posX),!d)return null;if(d.cell>=b)return e;e=d}},Cb=function(a,b,c){if(null===a&&null===b&&(a=b=c=0,u(a,b)))return{row:a,cell:b,posX:b};var d=Eb(a,b,c);if(d)return d;for(var e=null,f=kb();++a<f;)if(e=T(a),null!==e)return{row:a,cell:e,posX:e};return null},Db=function(a,b,c){if(null===a&&null===b&&(a=kb()-1,b=c=dd.activeColumns.length-1,u(a,b)))return{row:a,cell:b,posX:b};for(var d,e;!d&&!(d=Bb(a,b,c));){if(--a<0)return null;b=0,e=U(a),null!==e&&(d={row:a,cell:e,posX:e})}return d},Eb=function(a,b){if(b>=dd.activeColumns.length)return null;do b+=hb(a,b);while(b<dd.activeColumns.length&&!u(a,b));return b<dd.activeColumns.length?{row:a,cell:b,posX:b}:null},Fb=function(a,b,c){for(var d;;){if(--a<0)return null;for(d=b=0;c>=b;)d=b,b+=hb(a,b);if(u(a,d))return{row:a,cell:d,posX:c}}},Gb=function(){this.count=0,this.groups=null,this.id=null,this.level=0,this.grouprows=[],this.selectable=!1,this.title=null,this.value=null},Gb.prototype=new he,Gb.prototype.class=function(){var a=this.collapsed?jd:td;return[ud,wd,a].join(" ")},Gb.prototype.columns={0:{colspan:"*",formatter:function(a,b,c,d,e){var f=15*e.level;return[f?'<span style="margin-left:'+f+'px">':"",'<span class="icon"></span>','<span class="'+vd+'" level="'+e.level+'">',e.title,"</span>",f?"</span>":""].join("")}}},Gb.prototype.toString=function(){return"Group"},Ib=function(a){var c=$(a),d=rb(a);if(!(null===d||void 0===d||null!==Xd&&cd.active&&cd.active.row==c.row&&cd.active.cell==c.cell)){var e=ib(d);if(e&&e instanceof Gb){var f=b(a.target).hasClass(wd)||b(a.target).closest("."+wd).length;if(f)return e.collapsed?cd.collection.expandGroup(e[ce]):cd.collection.collapseGroup(e[ce]),a.stopImmediatePropagation(),a.preventDefault(),void 0}if(c&&(cd.trigger("click",a,{row:c.row,cell:c.cell,item:e}),!a.isImmediatePropagationStopped()&&u(c.row,c.cell))){if(cd.options.shiftSelect&&a.shiftKey&&cd.active&&(O(),cd.selectCells(cd.active.row,cd.active.cell,c.row,c.cell)),cd.options.ctrlSelect&&(a.ctrlKey||a.metaKey)&&cd.active)return $b(c.row,c.cell)?(O(c.row,c.cell),void 0):(cd.selection||cd.selectCells(cd.active.row,cd.active.cell,cd.active.row,cd.active.cell,!0),cd.selectCells(c.row,c.cell,c.row,c.cell,!0),void 0);Dc(c.row,!1),Gc(bb(c.row,c.cell))}}},Jb=function(a){var c=b(a.target).closest("."+hd,d);0!==c.length&&(cd.active&&cd.active.node===c[0]&&null!==Xd||cd.trigger("contextmenu",a))},Kb=function(a){var b=$(a);!b||null!==Xd&&cd.active&&cd.active.row==b.row&&cd.active.cell==b.cell||(cd.trigger("dblclick",a,{row:b.row,cell:b.cell}),a.isImmediatePropagationStopped()||cd.options.editable&&zb(b.row,b.cell,!0))},Mb=function(a){var b=gb(a);b&&cd.trigger("headerclick",a,{column:b})},Lb=function(a){var b=gb(a);cd.trigger("headercontextmenu",a,{column:b})},Nb=function(a){cd.active&&cd.trigger("keydown",a,{row:cd.active.row,cell:cd.active.cell});var b=a.isImmediatePropagationStopped();if(this._event=a,b||(67!=a.which||!a.ctrlKey&&!a.metaKey||a.altKey||a.shiftKey?a.shiftKey||a.altKey||a.ctrlKey?9!=a.which||!a.shiftKey||a.ctrlKey||a.altKey||(cd.options.editable&&Xd?H()&&(b=gc("prev")):b=gc("prev")):27==a.which?cd.options.editable&&Xd?(Xd.cancel(),d.focus(),b=!0):cd.selection?O():cd.active&&cd.activate():34==a.which?(Cc(1),b=!0):33==a.which?(Cc(-1),b=!0):36==a.which?(cd.scrollToRow(0),b=!0):35==a.which?(cd.scrollToRow(cd.collection.items.length-1),b=!0):37==a.which?cd.options.editable&&Xd?H()&&(b=gc("left")):b=gc("left"):39==a.which?cd.options.editable&&Xd?H()&&(b=gc("right")):b=gc("right"):38==a.which?cd.options.editable&&Xd?H()&&(b=gc("up")):b=gc("up"):40==a.which?cd.options.editable&&Xd?H()&&(b=gc("down")):b=gc("down"):9==a.which?cd.options.editable&&Xd?H()&&(b=gc("next")):b=gc("next"):13==a.which&&(cd.options.editable&&Xd?H()&&(b=gc("down")):b=gc("down")):I()),this._event=null,b){a.stopPropagation(),a.preventDefault();try{a.originalEvent.which=0}catch(c){}}},Ob=function(a){se=i[0].scrollTop,re=i[0].scrollLeft;var b=Math.abs(se-ne),c=Math.abs(re-me);if(c&&(me=re,g[0].scrollLeft=re),b)if(ve=se>ne?1:-1,ne=se,$c>b)Ec(se+ie);else{var d=ie;je=Hb==$c?0:Math.min(ec-1,Math.floor(se*((Qc-$c)/(Hb-$c))*(1/ic))),ie=Math.round(je*z),d!=ie&&Vb()}(c||b)&&($d&&clearTimeout($d),(Math.abs(ge-se)>20||Math.abs(fe-re)>20)&&(!cd.options.virtualScroll||Math.abs(ge-se)<$c&&Math.abs(fe-re)<bd?tc():$d=setTimeout(function(){tc(),$d=null},50),cd.trigger("viewportchanged",a,{}))),cd.trigger("scroll",a,{scrollLeft:re,scrollTop:se})},Pb=function(){cd.$el.is(":visible")&&Ac()},Qb=function(a){if(!a)return!1;var b=db(a);if(!b)return!1;var d=c.groupBy(cd.collection.groups,function(a){return a.column_id});return d[a]&&d[a].length?d[a][0]:!1},Rb=function(a){if(!a)return!1;var b=c.pluck(cd.sorting,"columnId");return b.indexOf(a)>=0},Tb=function(){var a=new he({__addRow:!0,data:{},formatter:function(){return""},id:"-add-row-"});cd.collection.add(a)},Zb=function(a,b){var c=kb();return dd.activeColumns[b].editable===!1?!1:c>a&&!ib(a)?!1:lb(a,b)?!0:!1},$b=function(a,b){if(!cd.selection)return!1;for(var c,d=0,e=cd.selection.length;e>d;d++)if(c=cd.selection[d],c.contains(a,b))return!0;return!1},_b=function(a){if(!cd.selection)return!1;var b=cd.collection.length;cd.collection.items[cd.collection.items.length-1].__gridAggregate&&b--;for(var c,d=0,e=cd.selection.length;e>d;d++)if(c=cd.selection[d],0===c.fromRow&&c.toRow===b&&c.fromCell>=a&&c.toCell<=a)return!0;return!1},Ub=function(){Wc(),Vb(),tc()},Vb=function(){Xd&&cc();for(var a in dd.nodes)sc(a)},Wb=function(a){delete dd.postprocess[a],ke=Math.min(ke,a),le=Math.max(le,a),Nc()},Xb=function(a){Yb([a])},Yb=function(a){if(a&&a.length){ve=0;for(var b=0,c=a.length;c>b;b++)Xd&&cd.active&&cd.active.row===a[b]&&cc(),dd.nodes[a[b]]&&sc(a[b])}},this.isGrouped=function(){return this.collection.groups.length?!0:!1},this.isSorted=function(){return this.sorting.length?!0:!1},ac=function(){cd.options.data.on("add",function(a){a.get("__nonDataRow")||cd.add(a)}).on("change",function(a){cd.setItem(a.id,a)}).on("remove",function(a){cd.remove(a.id)}).on("sort",function(){cd.collection.refresh(),Ub()})},bc=function(a){if(cd.active&&cd.active.node&&cd.options.editable===!0){clearTimeout(Zd);var c=dd.activeColumns[cd.active.cell],d=ib(cd.active.row);b(cd.active.node).addClass("editable"),a||(cd.active.node.innerHTML="");var e=a||lb(cd.active.row,cd.active.cell);Xd=new e({grid:cd,cell:cd.active.node,column:c,item:d||{},commitChanges:function(){cd.options.autoEdit&&gc("down")}}),Fc=Xd.serializeValue()}},cc=function(){if(Xd&&(Xd.destroy(),Xd=null,cd.active&&cd.active.node)){var a=ib(cd.active.row);if(b(cd.active.node).removeClass("editable invalid"),a){var c=dd.activeColumns[cd.active.cell],d=mb(cd.active.row,c);cd.active.node.innerHTML=d(cd.active.row,cd.active.cell,jb(a,c),c,a),Wb(cd.active.row)}}},dc=function(){var a=["paddingLeft","paddingRight"],c=["paddingTop","paddingBottom"],f=b('<div class="'+Ad+'" style="visibility:hidden">-</div>').appendTo(e);ae=be=0,"border-box"!=f.css("box-sizing")&&"border-box"!=f.css("-moz-box-sizing")&&"border-box"!=f.css("-webkit-box-sizing")&&(b.each(a,function(a,b){ae+=parseFloat(f.css(b))||0}),b.each(c,function(a,b){be+=parseFloat(f.css(b))||0})),f.remove();var g=b('<div class="'+Ld+'"></div>').appendTo(d);f=b('<div class="'+hd+'" style="visibility:hidden">-</div>').appendTo(g),fd=ed=0,"border-box"!=f.css("box-sizing")&&"border-box"!=f.css("-moz-box-sizing")&&"border-box"!=f.css("-webkit-box-sizing")&&(b.each(a,function(a,b){fd+=parseFloat(f.css(b))||0}),b.each(c,function(a,b){ed+=parseFloat(f.css(b))||0})),g.remove(),j=Math.max(ae,fd)},fc=function(a,b){var c,d,e=/(^-?[0-9]+(\.?[0-9]*)[df]?e?[0-9]?$|^0x[0-9a-f]+$|[0-9]+)/gi,f=/(^[ ]*|[ ]*$)/g,g=/(^([\w ]+,?[\w ]+)?[\w ]+,?[\w ]+\d+:\d+(:\d+)?[\w ]?|^\d{1,4}[\/\-]\d{1,4}[\/\-]\d{1,4}|^\w+, \w+ \d+, \d{4})/,h=/^0x[0-9a-f]+$/i,i=/^0/,j=function(a){return(""+a).toLowerCase()||""+a},k=j(a).replace(f,"")||"",l=j(b).replace(f,"")||"",m=k.replace(e,"\x00$1\x00").replace(/\0$/,"").replace(/^\0/,"").split("\x00"),n=l.replace(e,"\x00$1\x00").replace(/\0$/,"").replace(/^\0/,"").split("\x00"),o=parseInt(k.match(h),10)||1!=m.length&&k.match(g)&&Date.parse(k),p=parseInt(l.match(h),10)||o&&l.match(g)&&Date.parse(l)||null;if(p){if(p>o)return-1;if(o>p)return 1}for(var q=0,r=Math.max(m.length,n.length);r>q;q++){if(c=!(m[q]||"").match(i)&&parseFloat(m[q])||m[q]||0,d=!(n[q]||"").match(i)&&parseFloat(n[q])||n[q]||0,isNaN(c)!==isNaN(d))return isNaN(c)?1:-1;if(typeof c!=typeof d&&(c+="",d+=""),d>c)return-1;if(c>d)return 1}return 0},gc=function(a){if(!cd.options.keyboardNavigation)return!1;if(!(cd.active&&cd.active.node||"prev"==a||"next"==a))return!1;var b={up:-1,down:1,left:-1,right:1,prev:-1,next:1};te=b[a];var c={up:Fb,down:Ab,left:Bb,right:Eb,prev:Db,next:Cb},d=c[a],e=d(cd.active?cd.active.row:null,cd.active?cd.active.cell:null,k);if(e){var f=e.row==kb();return Bc(e.row,e.cell,!f),Gc(bb(e.row,e.cell)),k=e.posX,!0}return Gc(bb(cd.active?cd.active.row:null,cd.active?cd.active.cell:null)),!1},jc=function(a){a&&b.extend(this,a)},jc.prototype=new he,jc.prototype.toString=function(){return"Placeholder"},kc=function(a,b,c,d){c=void 0===c?a:c,d=void 0===d?b:d,this.fromRow=Math.min(a,c),this.fromCell=Math.min(b,d),this.toRow=Math.max(a,c),this.toCell=Math.max(b,d),this.exclusions=[]},kc.prototype.contains=function(a,b){return a>=this.fromRow&&a<=this.toRow&&b>=this.fromCell&&b<=this.toCell&&!this.isExcludedCell(a,b)},kc.prototype.deselect=function(a,b){var c=void 0!==a&&null!==a&&void 0!==b&&null!==b;if(c&&!this.contains(a,b))throw new Error("Unable to deselect cell ("+a+", "+b+") because it is not part of this Range.");c&&this.exclusions.push([a,b]);var d=[];if(void 0===a||null===a)for(var e=this.fromRow;e<=this.toRow;e++)d.indexOf(e)<0&&d.push(e);else d.push(a);var f={},g={};if(void 0!==b&&void 0!==b)f[dd.activeColumns[b].id]=cd.options.selectedClass;else for(var h=0,i=dd.activeColumns.length;i>h;h++)f[dd.activeColumns[h].id]=cd.options.selectedClass;for(var j=0,k=d.length;k>j;j++)g[d[j]]=f;return Tc(null,g),this},kc.prototype.excludeUnselectable=function(){for(var a=this.fromRow;a<=this.toRow;a++)for(var b=this.fromCell;b<=this.toCell;b++)v(a,b)||this.exclusions.push([a,b])},kc.prototype.fullyExcluded=function(){for(var a=this.fromRow;a<=this.toRow;a++)for(var b=this.fromCell;b<=this.toCell;b++)if(!this.isExcludedCell(a,b))return!1;return!0},kc.prototype.isExcludedCell=function(a,b){if(0===this.exclusions.length)return!1;for(var c=0,d=this.exclusions.length;d>c;c++)if(this.exclusions[c][0]===a&&this.exclusions[c][1]===b)return!0},kc.prototype.isSingleCell=function(){return this.fromRow==this.toRow&&this.fromCell==this.toCell},kc.prototype.isSingleRow=function(){return this.fromRow==this.toRow},kc.prototype.toCSV=function(){for(var a=this.toJSON(),b=[],c=0,d=a.length;d>c;c++)b.push('"'+a[c].join('","')+'"');return b.join("\n")},kc.prototype.toJSON=function(){for(var a,b,c,d=[],e=this.fromRow;e<=this.toRow;e++)if(b=dd.rows[e],!(b instanceof he)){c=[];for(var f=this.fromCell;f<=this.toCell;f++)this.isExcludedCell(b,f)?c.push(null):(a=dd.activeColumns[f],c.push(vb(b,a)));d.push(c)}return d},kc.prototype.toString=function(){return this.isSingleCell()?"Range ("+this.fromRow+":"+this.fromCell+")":"Range ("+this.fromRow+":"+this.fromCell+" - "+this.toRow+":"+this.toCell+")"},lc=function(){for(var a=0,b=dd.rows.length;b>a;a++)if(dd.rows[a]instanceof jc)return!1;return!0},nc=function(a){var b={};oe.count(b,function(b){cd.collection.length=b,V(),Wc(),cd.collection.refresh(),a()})},oc=function(){var a=yb(),b=a.top,c=a.bottom;pe&&"function"==typeof pe.abort&&pe.abort(),null!==qe&&clearTimeout(qe),0>b&&(b=0),cd.collection.length>0&&(c=Math.min(c,cd.collection.length-1));for(var d,e,f,g=cd.collection.groups.length?0:b,h=0,i=0,j=g;c>=j;j++)f=dd.rows[j],f&&f instanceof Gb&&f.collapsed?void 0===d&&(i+=f.count,h++):(f&&f instanceof he&&!(f instanceof jc)&&h++,b>j||(!f||f instanceof jc)&&(void 0===d&&(d=j-h+i),e=j-h+i));return void 0===d?(mc(),void 0):(qe=setTimeout(function(){try{"function"==typeof oe.onLoading&&oe.onLoading();var a=[];if(cd.collection.groups)for(var b=0,c=cd.collection.groups.length;c>b;b++)a.push({columnId:cd.collection.groups[b].column_id,sortAsc:!0});cd.sorting&&(a=a.concat(cd.sorting));var f={columns:dd.activeColumns,limit:e-d+1,offset:d,order:a};pe=oe.fetch(f,function(a){cd.collection.add(a,{at:d,merge:!0}),pe=null,mc(d+h-i,e+h-i),"function"==typeof oe.onLoaded&&oe.onLoaded()})}catch(g){throw new Error("Doby Grid remote fetching failed due to: "+g)}},cd.options.remoteScrollTime),void 0)},pc=function(a){if(pe&&"function"==typeof pe.abort&&pe.abort(),dd.remoteGroups)a(dd.remoteGroups);else{var b={groups:cd.collection.groups};"function"==typeof oe.onLoading&&oe.onLoading(),pe=oe.fetchGroups(b,function(b){pe=null,dd.remoteGroups=b,a(b),"function"==typeof oe.onLoaded&&oe.onLoaded()})}},mc=function(a,b){for(var c=a;b>=c;c++)Xb(c);Wc(),tc()},this.remove=function(a){return this.collection.remove(a),this},this.removeColumn=function(a){if(!a)return this;"object"==typeof a&&(a=a.id);var b,c=this.options.columns.filter(function(c){if(c.id==a&&(b=c,c.removable!==!0))throw new Error('Cannot remove column "'+c.id+'" because it is not removable.');return c.id!=a});if(!b)throw new Error('Cannot remove column "'+a+'" because no such column exists.');Qb(a)&&this.removeGrouping(a);var d;return b&&b.quickFilterInput&&(b.quickFilterInput.parent().remove(),d=!0),cd.setColumns(c),d&&m(),this},qc=function(){h&&h.remove(),Oc=null},this.removeGrouping=function(a){if(a){"object"==typeof a&&(a=a.id);var b=Qb(a);return b&&(this.collection.groups.splice(this.collection.groups.indexOf(b),1),this.setGrouping(this.collection.groups)),this}},rc=function(a){for(var b=[],c=0,d=a.length;d>c;c++){var e=a[c];v(e.fromRow,e.fromCell)&&v(e.toRow,e.toCell)&&b.push(e)}return b},sc=function(a){var b,c=dd.nodes[a];if(c&&(d[0].removeChild(c.rowNode),delete dd.nodes[a],dd.postprocess[a]))for(var e in dd.postprocess[a])b=dd.activeColumns[e],b.cache||delete dd.postprocess[a][e]},tc=function(){if(ee){var a=yb(),b=qb();C(b),fe!=re&&A(b),cd.$el&&(!ad&&cd.options.autoColumnWidth?cd.$el.addClass(Id):cd.$el.removeClass(Id)),yc(b),ke=a.top,le=Math.min(kb()-1,a.bottom),Nc(),ge=se,fe=re}},uc=function(a,b,c,d,e){var f=dd.activeColumns[c],g=e&&e.columns||{},h=Math.min(dd.activeColumns.length-1,c+d-1),i=e instanceof Gb?"":f.class?"function"==typeof f.class?f.class():f.class:null,j=[hd,"l"+c,"r"+h];if(i&&j.push(i),cd.active&&b===cd.active.row&&c===cd.active.cell&&j.push("active"),g[c]&&g[c].class&&j.push(g[c].class),$b(b,c)&&j.push(cd.options.selectedClass),a.push('<div class="'+j.join(" ")+'">'),f.cache&&f.postprocess&&dd.postprocess[b]&&dd.postprocess[b][c])a.push(dd.postprocess[b][c]);else if(e){var k=jb(e,f);try{a.push(mb(b,f)(b,c,k,f,e))}catch(l){a.push(""),console.error&&console.error("Cell failed to render due to failed column formatter. Error: "+l.message,l)}}a.push("</div>"),dd.nodes[b].cellRenderQueue.push(c),dd.nodes[b].cellColSpans[c]=d},vc=function(){e.is(":empty")||(e.empty(),e.width(nb()));for(var a,b,c,d=[],f=0,g=dd.activeColumns.length;g>f;f++)a=dd.activeColumns[f],b=[Ad,a.headerClass||""],a.sortable&&b.push(Gd),c=a.width-ae,d.push('<div class="'+b.join(" ")+'" style="width:'+c+'px" '),d.push('id="'+(ue+a.id)+'"'),void 0!==a.tooltip&&null!==a.tooltip&&"title"==cd.options.tooltipType&&d.push(' title="'+a.tooltip+'"'),d.push(">"),d.push('<span class="'+kd+'">'+a.name+"</span>"),a.sortable&&d.push('<span class="'+Pd+'"></span>'),d.push("</div>");e.append(d.join("")),Pc(),cd.options.resizableColumns&&Jc(),cd.options.reorderable&&Ic()},wc=function(a,d){var e=b(['<div class="',nd,'"></div>'].join(""));c.each(a,function(a){if(void 0===a.enabled||a.enabled)if(a.divider)e.append(['<div class="',pd,'"></div>'].join(""));else{var c=a.name||"",d="";void 0!==a.value&&(a.value&&(d=" on"),c+=['<span class="',rd,'"></span>'].join(""));var f=['<div class="',od," ",d,'">',c,"</div>"].join(""),g=b(f).appendTo(e);a.menu&&(g.append(['<span class="',qd,'"></span>'].join("")),wc(a.menu,g)),g.click(function(b){"function"==typeof a.fn?a.fn.bind(this)(b):a.menu&&b.stopPropagation()})}}),e.appendTo(d)},xc=function(a,b,c){var d,e=ib(b),f=Ld+(cd.active&&b===cd.active.row?" active":"")+(1===b%2?" odd":""),g={};if(Zc?(g=dd.rowPositions[b],d=g.top-ie):d=cd.options.rowHeight*b-ie+1*b,e&&e.class&&(f+=" "+("function"==typeof e.class?e.class():e.class)),a.push("<div class='"+f+"' style='top:"+d+"px"),Zc&&g.height){var h=g.height-ed;a.push(";height:"+h+"px;line-height:"+(h+cd.options.lineHeightOffset)+"px")}a.push("'>");var i,j,k,l;for(k=0,l=dd.activeColumns.length;l>k;k++){if(j=dd.activeColumns[k],i=1,e&&e.columns){var m=e.columns[j.id]||e.columns[k];i=m&&m.colspan||1,"*"===i&&(i=l-k)}if(dd.columnPosRight[Math.min(l-1,k+i-1)]>c.leftPx){if(dd.columnPosLeft[k]>c.rightPx)break;uc(a,b,k,i,e)}i>1&&(k+=i-1)}cd.options.resizableRows&&e.resizable!==!1&&(a.push('<div class="'),a.push(Nd),a.push('"></div>')),a.push("</div>")},yc=function(a){var b,c,e=[],f=[],g=!1;for(b=a.top,c=a.bottom;c>=b;b++)dd.nodes[b]||(f.push(b),dd.nodes[b]={rowNode:null,cellColSpans:[],cellNodesByColumnIdx:[],cellRenderQueue:[]},xc(e,b,a),cd.active&&cd.active.node&&cd.active.row===b&&(g=!0),Wd++);if(f.length){var h=document.createElement("div");for(h.innerHTML=e.join(""),b=0,c=f.length;c>b;b++)dd.nodes[f[b]].rowNode=d[0].appendChild(h.firstChild);g&&(cd.active.node=bb(cd.active.row,cd.active.cell))}},this.reset=function(a){return this.collection.reset(a,!0),this},zc=function(){Gc(null,!1)},this.resize=function(){return Ac(),Ub(),this},Ac=function(){ee&&($c=xb(),t(),bd=parseFloat(b.css(cd.$el[0],"width",!0)),i.height($c),Wc(),cd.options.autoColumnWidth&&p(),fe=-1,tc())},Bc=function(a,b,c){Dc(a,c);var d=hb(a,b),e=dd.columnPosLeft[b],f=dd.columnPosRight[b+(d>1?d-1:0)],g=re+bd;re>e?(i.scrollLeft(e),Ob(),tc()):f>g&&(i.scrollLeft(Math.min(e,f-i[0].clientWidth)),Ob(),tc())},Cc=function(a){var b,c=a*hc,d=tb(se)+c;if(d=0>d?0:d,Zc){if(!dd.rowPositions[d])return;b=dd.rowPositions[d].top}else b=d*(cd.options.rowHeight+1);if(Ec(b),tc(),cd.options.activeFollowsPage&&cd.active&&null!==cd.active.row){var e=cd.active.row+c,f=kb();e>=f&&(e=f-1),0>e&&(e=0);for(var g=0,h=null,i=k;k>=g;)u(e,g)&&(h=g),g+=hb(e,g);null!==h?(Gc(bb(e,h)),k=i):zc()}},Dc=function(a,b){var c,d,e;Zc?(e=dd.rowPositions[a],c=e.top,d=e.bottom-$c+(_c?window.scrollbarDimensions.height:0)):(c=a*cd.options.rowHeight,d=(a+1)*cd.options.rowHeight-$c+(_c?window.scrollbarDimensions.height:0));var f,g;Zc?(f=e.bottom>se+$c+ie,g=e.top<se+ie):(f=(a+1)*cd.options.rowHeight>se+$c+ie,g=a*cd.options.rowHeight<se+ie),f?(Ec(b?c:d),tc()):g&&(Ec(b?d:c),tc())},Ec=function(a){a=Math.max(a,0),a=Math.min(a,Qc-$c+(_c?window.scrollbarDimensions.height:0));var b=ie;je=Math.min(ec-1,Math.floor(a/ic)),ie=Math.round(je*z);var c=a-ie;if(Zc&&t(),ie!=b){var d=yb(c);C(d)}ne!=c&&(ve=c+ie>ne+b?1:-1,i[0].scrollTop=ge=se=ne=c,cd.trigger("viewportchanged",{}))},this.scrollToRow=function(a){if(Zc){var b=dd.rowPositions[a];Ec(b.top)}else Ec(a*(this.options.rowHeight+1));return tc(),this},this.selectCells=function(a,b,d,e,f){if(this.options.selectable){if(void 0===a&&void 0===b&&void 0===d&&void 0===e)return O(),void 0;var g=["startRow","startCell","endRow","endCell"];c.each([a,b,d,e],function(a,b){if(void 0===a)throw new Error('Unable to select cell range because "'+g[b]+'" param is missing.')});var h,i,j,k,l,m=new kc(a,b,d,e);if(m.excludeUnselectable(),!m.fullyExcluded()){if(m.isSingleCell()&&this.selection)for(i=0,j=this.selection.length;j>i;i++){if(this.selection[i].contains(a,b))return;if(this.selection[i].isExcludedCell(a,b)){var n=this.selection[i].exclusions.indexOf([a,b]);this.selection[i].exclusions.splice(n,1);var o={};return o[a]={},o[a][dd.activeColumns[b].id]=this.options.selectedClass,Tc(o),void 0}}f?(this.selection||(this.selection=[]),h=this.selection,h.push(m)):h=[m],this.selection=h;var p={};for(i=0,j=this.selection.length;j>i;i++)for(k=this.selection[i].fromRow;k<=this.selection[i].toRow;k++)for(p[k]||(p[k]={}),l=cd.selection[i].fromCell;l<=this.selection[i].toCell;l++)v(k,l)&&!this.selection[i].isExcludedCell(k,l)&&(p[k][dd.activeColumns[l].id]=this.options.selectedClass);Tc(p),this.trigger("selection",this._event)}}},Gc=function(a,c){cd.active&&null!==cd.active.node&&(cc(),b(cd.active.node).removeClass("active"),dd.nodes[cd.active.row]&&b(dd.nodes[cd.active.row].rowNode).removeClass("active")),cd.active||(cd.active={cell:null,node:null,row:null});var d=cd.active.node!==a;null!==a?(cd.active.node=a,cd.active.row=sb(cd.active.node.parentNode),cd.active.cell=k=_(cd.active.node),(null===c||void 0===c)&&(c=cd.active.row==kb()||cd.options.autoEdit),b(cd.active.node).addClass("active"),b(dd.nodes[cd.active.row].rowNode).addClass("active"),cd.options.editable&&c&&Zb(cd.active.row,cd.active.cell)&&(clearTimeout(Zd),cd.options.asyncEditorLoading?Zd=setTimeout(function(){bc()},cd.options.asyncEditorLoadDelay):bc())):cd.active.row=cd.active.cell=null,d&&cd.trigger("activecellchange",{},W())},this.setColumns=function(a){this.options.columns=a;for(var c,d=0,e=this.options.columns.length;e>d;d++)c=cd.options.columns[d]=b.extend(JSON.parse(JSON.stringify(we)),cd.options.columns[d]),c.minWidth&&c.width<c.minWidth&&(c.width=c.minWidth),c.maxWidth&&c.width>c.maxWidth&&(c.width=c.maxWidth);Xc(),Uc(),this.trigger("columnchange",{},{columns:a}),ee&&(Vb(),vc(),qc(),J(),Ac(),n(),Ob())},this.setGrouping=function(a){return this.collection.setGrouping(a),this},this.setItem=function(a,b){return this.collection.setItem(a,b),this},this.setOptions=function(a){cc(),a.data&&this.reset(a.data),void 0!==a.addRow&&cd.options.addRow!==a.addRow&&(a.addRow?Tb():this.remove("-add-row-")),cd.options=b.extend(cd.options,a),Yc(),a.columns?this.setColumns(a.columns):tc(),"autoColumnWidth"in a&&(Jc(),p())},Hc=function(a,b){var d=dd.rows[a];d.height=b,Yb(c.range(a,dd.rows.length)),d instanceof Gb?(d.predef.grouprows[d.id]={height:b},Yb(c.range(a,dd.rows.length)),s(a),tc()):cd.collection.setItem(d[ce],d),Wc()},this.setSorting=function(a){if(!b.isArray(a))throw new Error('Doby Grid cannot set the sorting because the "options" parameter must be an array of objects.');if(!this.options.multiColumnSort&&a.length>1)throw new Error('Doby Grid cannot set the sorting given because "multiColumnSort" is disabled and the given sorting options contain multiple columns.');var d=null;c.each(a,function(a){c.each(dd.activeColumns,function(b){if(a.columnId===b.id&&(d=b,b.sortable===!1))throw new Error('Doby Grid cannot sort by "'+b.id+'" because that column is not sortable.')})}.bind(this)),this.sorting=a,Pc();var e={multiColumnSort:!0,sortCols:[]};return c.each(a,function(a){e.sortCols.push({sortCol:db(a.columnId),sortAsc:null!==a.sortAsc&&void 0!==a.sortAsc?a.sortAsc:d.sortAsc})}),S(e),this},Ic=function(){e.filter(":ui-sortable").length||e.sortable({axis:"x",containment:"parent",cursor:"default",distance:3,helper:"clone",placeholder:Jd+" "+Ad,tolerance:"intersection",start:function(a,c){c.placeholder.width(c.helper.outerWidth()-ae),b(c.helper).addClass(Bd)},beforeStop:function(a,c){b(c.helper).removeClass(Bd)},update:function(a){a.stopPropagation();for(var b,c=e.sortable("toArray"),d=[],f=0,g=c.length;g>f;f++)b=dd.columnsById[c[f].replace(ue,"")],d.push(dd.activeColumns[b]);dd.postprocess={},Nc(),cd.setColumns(d),Jc(),cd.trigger("columnreorder",a)}})},Jc=function(){if(cd.options.resizableColumns){var a,c,d,f,g,h,i,k,l;if(g=e.children(),g.find("."+xd).remove(),g.each(function(a){dd.activeColumns[a].resizable&&(void 0===k&&(k=a),l=a)}),void 0!==k){var o=function(){g.each(function(a){dd.activeColumns[a].previousWidth=dd.activeColumns[a].width})},p=function(b,e){var f,h;if(h=e,0>e){for(a=b;a>=0;a--)c=dd.activeColumns[a],c.resizable&&(f=Math.max(c.minWidth||0,j),h&&c.previousWidth+h<f?(h+=c.previousWidth-f,c.width=f):(c.width=c.previousWidth+h,h=0));if(cd.options.autoColumnWidth)for(h=-e,a=b+1;a<g.length;a++)c=dd.activeColumns[a],c.resizable&&(h&&c.maxWidth&&c.maxWidth-c.previousWidth<h?(h-=c.maxWidth-c.previousWidth,c.width=c.maxWidth):(c.width=c.previousWidth+h,h=0))}else{for(a=b;a>=0;a--)c=dd.activeColumns[a],c.resizable&&(h&&c.maxWidth&&c.maxWidth-c.previousWidth<h?(h-=c.maxWidth-c.previousWidth,c.width=c.maxWidth):(c.width=c.previousWidth+h,h=0));if(cd.options.autoColumnWidth)for(h=-e,a=b+1,d=g.length;d>a;a++)c=dd.activeColumns[a],c.resizable&&(f=Math.max(c.minWidth||0,j),h&&c.previousWidth+h<f?(h+=c.previousWidth-f,c.width=f):(c.width=c.previousWidth+h,h=0))}},q=function(b,d){var e=null,f=null;if(cd.options.autoColumnWidth)for(e=0,f=0,a=b+1;a<g.length;a++)c=dd.activeColumns[a],c.resizable&&(null!==f&&(c.maxWidth?f+=c.maxWidth-c.previousWidth:f=null),e+=c.previousWidth-Math.max(c.minWidth||0,j));var k=0,l=0;for(a=0;b>=a;a++)c=dd.activeColumns[a],c.resizable&&(null!==l&&(c.maxWidth?l+=c.maxWidth-c.previousWidth:l=null),k+=c.previousWidth-Math.max(c.minWidth||0,j));null===e&&(e=1e5),null===k&&(k=1e5),null===f&&(f=1e5),null===l&&(l=1e5),i=d+Math.min(e,l),h=d-Math.min(k,f)
},r=function(){m(),cd.options.resizeCells&&n()},s=function(){var d;for(a=0;a<g.length;a++)c=dd.activeColumns[a],d=b(g[a]).outerWidth(),c.previousWidth!==d&&c.rerenderOnResize&&Vb();Sc(!0),tc(),cd.trigger("columnresize",{})};e.on("dblclick",function(a){if(b(a.target).closest("."+xd).length){var c=gb(a);if(c){var d=dd.columnsById[c.id],e=c.width,g=Math.max(fb(d),c.minWidth);if(e!=g){var h=g-e;o(d),q(d,f),p(d,h),r(),s()}}}}),b.each(g,function(a,c){k>a||cd.options.autoColumnWidth&&a>=l||dd.activeColumns[a].resizable===!1||b('<div class="'+xd+'"><span></span></div>').appendTo(c).on("dragstart",function(c){f=c.pageX,b(this).parent().addClass(Cd),o(a),q(a,f)}).on("drag",function(b){var c=Math.min(i,Math.max(h,b.pageX))-f;p(a,c),r()}).on("dragend",function(){b(this).parent().removeClass(Cd),s()})})}}},Kc=function(){e.click(function(a){var c=b(a.target).closest("."+xd);if(!c.length){var d=gb(a);if(d&&d.sortable){for(var e=null,f=0,g=cd.sorting.length;g>f;f++)if(cd.sorting[f].columnId==d.id){e=cd.sorting[f],e.sortAsc=!e.sortAsc;break}a.metaKey&&cd.options.multiColumnSort?e&&cd.sorting.splice(f,1):((a.shiftKey||a.metaKey)&&cd.options.multiColumnSort||(cd.sorting=[]),e?0===cd.sorting.length&&cd.sorting.push(e):(e={columnId:d.id,sortAsc:d.sortAsc},cd.sorting.push(e))),Pc(cd.sorting);var h;h=cd.options.multiColumnSort?{multiColumnSort:!0,sortCols:b.map(cd.sorting,function(a){return{sortCol:dd.activeColumns[dd.columnsById[a.columnId]],sortAsc:a.sortAsc}})}:{multiColumnSort:!1,sortCol:d,sortAsc:e.sortAsc},S(h),cd.trigger("sort",a,h)}}})},Lc=function(a){if(void 0===a&&f)return f.remove(),f=void 0,$c=xb(),i.height($c),void 0;var c,d=function(){c&&clearTimeout(c),c=setTimeout(function(){cd.filter(function(a){for(var b,c,d,e=!0,f=0,g=dd.activeColumns.length;g>f;f++)b=dd.activeColumns[f],e&&b.quickFilterInput&&(d=b.quickFilterInput.val(),c=jb(a,b),void 0!==c&&null!==c&&(c=c.toString()),e*=d&&c?c.toLowerCase().indexOf(d.toLowerCase())>=0:!0);return e})},150)};if(f)a&&a.quickFilterInput&&a.quickFilterInput.select().focus();else{f=b('<div class="'+Ed+'"></div>').appendTo(g);for(var e,h,j,k=0,l=dd.activeColumns.length;l>k;k++)e=dd.activeColumns[k],j=['<div class="'],j.push(Fd),j.push('">'),j.push("</div>"),h=b(j.join("")),h.appendTo(f),e.quickFilterInput=b('<input class="editor" type="text"/>').appendTo(h).data("column_id",e.id).on("keyup",d),a&&a.id==e.id&&e.quickFilterInput.select().focus()}m(),$c=xb(),i.height($c)},Mc=function(a){if("popup"==cd.options.tooltipType){if(b(a.target).closest("."+xd).length)return b(a.target).trigger("mouseleave"),void 0;var c=gb(a);if(c&&c.tooltip){var d=b(a.target).closest("."+Ad);if(!d.attr("aria-describedby")){var e=ue+"-tooltip-column-"+c.id;d.attr("aria-describedby",e),d.one("mouseleave",function(){if(void 0!==b(this).attr("aria-describedby")){var a=b("#"+e);a.removeClass("on"),setTimeout(function(){a.remove()},200),b(this).removeAttr("aria-describedby")}}),setTimeout(function(){if(void 0!==d.attr("aria-describedby")&&d.is(":visible")){var a=10,f=['<span class="'+Sd+'" id="'+e+'">'];if(f.push(c.tooltip),f.push('<span class="'+Td+'"></span>'),f.push("</span>"),!b("#"+e).length){var g=b(f.join(""));g.appendTo(document.body);var h=d.offset().left+d.outerWidth()/2-g.outerWidth()/2,i=d.offset().top+d.outerHeight()+a,j=0,k=b(window),l=k.outerWidth();0>h?(j=h,h=0):h+g.outerWidth()>l&&(j=h+g.outerWidth()-l,h-=j+1);var m=g.children("."+Td).first();m.css("left",g.outerWidth()/2-m.outerWidth()/2+j),g.remove().addClass("on").attr("style","left:"+h+"px;top:"+(i+5)+"px").appendTo(document.body).width(),g.css("top",i)}}},250)}}}},this.sortBy=function(a,b){if(!a)throw new Error("Grid cannot sort by blank value. Column Id must be specified.");return this.setSorting([{columnId:a,sortAsc:b}])},Nc=function(){Yd&&(clearTimeout(_d),_d=setTimeout(o,cd.options.asyncPostRenderDelay))},Pc=function(){var a=e.children();a.removeClass(Dd).find("."+Pd).removeClass(Qd+" "+Rd),b.each(cd.sorting,function(b,c){null===c.sortAsc&&(c.sortAsc=!0);var d=dd.columnsById[c.columnId];null!==d&&a.eq(d).addClass(Dd).find("."+Pd).addClass(c.sortAsc?Qd:Rd)})},this.toString=function(){return"DobyGrid"},Rc=function(a,d){a.preventDefault();var e,g=d.column||!1,h=function(a){return function(c){c.stopPropagation();var d=db(a.id);d.visible=!d.visible,d.visible?b(this).addClass("on"):b(this).removeClass("on"),cd.setColumns(cd.options.columns)}},i=[],j=c.sortBy(cd.options.columns,function(a){return a.name});c.each(j,function(a){a.removable&&i.push({name:void 0!==a.name&&null!==a.name?a.name:a.id,fn:h(a),value:a.visible})});var k=function(a,c){return function(d){if(1!==Object.keys(dd.aggregatorsByColumnId[a.id]).length){b(d.target).parent().children("."+od).removeClass("on"),b(d.target).addClass("on"),b(d.target).children("."+rd).length||b(d.target).append('<span class="'+rd+'"></span>');for(var e in dd.aggregatorsByColumnId[a.id])dd.aggregatorsByColumnId[a.id][e].active=e==c;for(var f=yb(),g=f.top,h=f.bottom;h>g;g++)dd.rows[g]instanceof l&&Xb(g);cd.collection.refresh()}}},m=[];g&&dd.aggregatorsByColumnId[g.id]&&c.each(dd.aggregatorsByColumnId[g.id],function(a,b){m.push({fn:k(g,b),name:g.aggregators[b].name,value:a.active})});var n=[{enabled:g&&cd.options.quickFilter,name:g?ob("column.filter",{name:g.name}):"",fn:function(){Lc(g)}},{enabled:void 0!==f,name:ob("global.hide_filter"),fn:function(){Lc()}},{enabled:cd.options.quickFilter||void 0!==f,divider:!0},{enabled:g&&g.removable,name:g?ob("column.remove",{name:g.name}):"",fn:function(){cd.removeColumn(g.id)}},{enabled:g&&g.removable,divider:!0},{enabled:g&&g.sortable,name:ob("column.sorting"),menu:[{enabled:!Rb(g.id),name:g?ob("column.sort_asc",{name:g.name}):"",fn:function(){cd.sortBy(g.id,!0)}},{enabled:!Rb(g.id),name:g?ob("column.sort_desc",{name:g.name}):"",fn:function(){cd.sortBy(g.id,!1)}},{enabled:cd.isSorted()&&!Rb(g.id),name:g?ob("column.add_sort_asc",{name:g.name}):"",fn:function(){cd.sorting.push({columnId:g.id,sortAsc:!0}),cd.setSorting(cd.sorting)}},{enabled:cd.isSorted()&&!Rb(g.id),name:g?ob("column.add_sort_desc",{name:g.name}):"",fn:function(){cd.sorting.push({columnId:g.id,sortAsc:!1}),cd.setSorting(cd.sorting)}},{enabled:Rb(g.id),name:g?ob("column.remove_sort",{name:g.name}):"",fn:function(){cd.sorting=c.filter(cd.sorting,function(a){return a.columnId!=g.id}),cd.setSorting(cd.sorting)}}]},{enabled:cd.options.groupable&&g&&g.groupable,name:ob("column.grouping"),menu:[{enabled:!Qb(g.id)||!cd.isGrouped(),name:g?ob("column.group",{name:g.name}):"",fn:function(){cd.setGrouping([{column_id:g.id}]),e.hide()}},{enabled:!Qb(g.id)&&cd.isGrouped(),name:g?ob("column.add_group",{name:g.name}):"",fn:function(){cd.addGrouping(g.id),e.hide()}},{enabled:Qb(g.id),name:g?ob("column.remove_group",{name:g.name}):"",fn:function(){cd.removeGrouping(g.id),e.hide()}},{enabled:cd.isGrouped(),name:ob("column.groups_clear"),fn:function(){cd.setGrouping(),e.hide()}},{enabled:cd.isGrouped(),divider:!0},{enabled:cd.isGrouped(),name:ob("column.groups_expand"),fn:function(){cd.collection.expandAllGroups()}},{enabled:cd.isGrouped(),name:ob("column.groups_collapse"),fn:function(){cd.collection.collapseAllGroups()}}]},{enabled:g&&void 0!==g.aggregators,name:ob("column.aggregators"),menu:m},{enabled:g&&!_b(dd.columnsById[g.id]),name:ob("column.select"),fn:function(){var a=dd.columnsById[g.id];cd.selectCells(0,a,dd.rows.length-1,a)}},{enabled:g&&_b(dd.columnsById[g.id]),name:ob("column.deselect"),fn:function(){for(var a=dd.columnsById[g.id],b=0;b<dd.rows.length-1;b++)O(b,a)}},{enabled:g&&(g.sortable||g.removable||g.groupable||g.aggregators),divider:!0},{enabled:i.length>0,name:ob("global.columns"),menu:i},{enabled:i.length>0,divider:!0},{enabled:de,name:ob("global.export"),menu:[{name:ob("global.export_csv"),fn:function(){var a=cd.export("csv"),b=new Blob([a],{type:"text/csv;charset=utf-8"});saveAs(b,[cd.options.exportFileName,".csv"].join(""))}},{name:ob("global.export_html"),fn:function(){var a=cd.export("html"),b=new Blob([a],{type:"text/html;charset=utf-8"});saveAs(b,[cd.options.exportFileName,".html"].join(""))}}]},{divider:!0},{name:ob("global.auto_width"),value:cd.options.autoColumnWidth,fn:function(){cd.setOptions({autoColumnWidth:!cd.options.autoColumnWidth})}}],o=b('<div class="'+ld+'"></div>');wc(n,o);var p;o.on("mouseover",function(a){p&&clearTimeout(p);var c=b(a.target).hasClass(od)?b(a.target):b(a.target).parent().hasClass(od)?b(a.target).parent():null;c&&(p=setTimeout(function(){c.parent().children(".open").removeClass("open"),c.addClass("open")},200))}),e=new Q(a,{id:g.id,menu:o,parent:cd.$el})},Sc=function(a){var b=w;w=Y(),w!=b&&(d.width(w),e.width(nb()),_c=w>bd-window.scrollbarDimensions.width),(w!=b||a)&&n()},Tc=function(a,c){var d,e,f,g;for(var h in dd.nodes){if(g=c&&c[h],f=a&&a[h],g)for(e in g)f&&g[e]==f[e]||(d=bb(h,dd.columnsById[e]),d&&b(d).removeClass(g[e]));if(f)for(e in f)g&&g[e]==f[e]||(d=bb(h,dd.columnsById[e]),d&&b(d).addClass(f[e]))}},Uc=function(){dd.columnPosLeft=[],dd.columnPosRight=[],dd.aggregatorsByColumnId={};for(var a,b=0,c=0,d=dd.activeColumns.length;d>c;c++)if(a=dd.activeColumns[c],dd.columnPosLeft[c]=b,dd.columnPosRight[c]=b+a.width,b+=a.width,a.aggregators)for(var e=0,f=a.aggregators.length;f>e;e++)dd.aggregatorsByColumnId[a.id]||(dd.aggregatorsByColumnId[a.id]={}),dd.aggregatorsByColumnId[a.id][e]=new a.aggregators[e].fn(a)},Vc=function(a){var b=dd.nodes[a];if(b){R(a);var c=ib(a);for(var d in b.cellNodesByColumnIdx)if(b.cellNodesByColumnIdx.hasOwnProperty(d)){d=0|d;var e=dd.activeColumns[d],f=b.cellNodesByColumnIdx[d];cd.active&&a===cd.active.row&&d===cd.active.cell&&Xd?Xd.loadValue(c):f.innerHTML=c?mb(a,e)(a,d,jb(c,e),e,c):""}Wb(a)}},Wc=function(){if(ee){var a=dd.rows.length,b=ad;if(0===a)ad=!1;else if(Zc){var c=dd.rowPositions[a-1];ad=c&&c.bottom>$c}else ad=a*cd.options.rowHeight>$c;cc();for(var e in dd.nodes)e>=a&&sc(e);cd.active&&cd.active.node&&cd.active.row>a&&zc();var f=Hb;if(0===a)Qc=$c-window.scrollbarDimensions.height;else{var g;if(Zc){var h=a-1,j=dd.rowPositions[h];g=j.bottom}else g=cd.options.rowHeight*a+a;Qc=Math.max(g,$c-window.scrollbarDimensions.height)}Qc<window.maxSupportedCssHeight?(Hb=ic=Qc,ec=1,z=0):(Hb=window.maxSupportedCssHeight,ic=Hb/100,ec=Math.floor(Qc/ic),z=(Qc-Hb)/(ec-1)),Hb!==f&&(d.css("height",Hb),se=i[0].scrollTop);var k=Qc-$c>=se+ie;0===Qc||0===se?je=ie=0:k?Ec(se+ie):Ec(Qc-$c),cd.options.autoColumnWidth&&void 0!==b&&b!=ad&&p(),Sc(!1)}},Xc=function(){if(cd.options.columns){dd.activeColumns=[],dd.columnsById={};for(var a,c=0,d=cd.options.columns.length;d>c;c++){if(a=cd.options.columns[c]=b.extend(JSON.parse(JSON.stringify(we)),cd.options.columns[c]),(void 0===a.id||null===a.id)&&(a.id=a.field?a.field+"_"+c:a.name?a.name+"_"+c:null),a.tooltip){var e=a.headerClass?a.headerClass+" tooltip":"tooltip";a.headerClass=e,a.toolTip=a.tooltip}a.postprocess&&(Yd=!0),(void 0===a.width||null===a.width)&&(a.width=cd.options.columnWidth),void 0!==a.minWidth&&null!==a.minWidth&&a.width<a.minWidth&&(a.width=a.minWidth),void 0!==a.maxWidth&&null!==a.maxWidth&&a.width>a.maxWidth&&(a.width=a.maxWidth);for(var f,g=["editor","exporter","formatter"],h=0,i=g.length;i>h;h++)if(f=g[h],void 0!==a[f]&&null!==a[f]&&"function"!=typeof a[f])throw new Error(["Column ",f,"s must be functions. ","Invalid ",f,' given for column "',a.name||a.id,'"'].join(""));if(void 0!==a.aggregators&&null!==a.aggregators&&!b.isArray(a.aggregators))throw new Error(['A column\'s "aggregators" value must be array. ','Invalid value given for column "',a.name||a.id,'"'].join(""));a.visible!==!1&&(dd.activeColumns.push(a),dd.columnsById[a.id]=dd.activeColumns.length-1)}}},Yc=function(){if(cd.options.resizableColumns&&!b.fn.drag)throw new Error('In order to use "resizable", you must ensure the jquery-ui.draggable module is loaded.');if(cd.options.reorderable&&!b.fn.sortable)throw new Error('In order to use "reorderable", you must ensure the jquery-ui.sortable module is loaded.');if(!c.isArray(cd.options.columns))throw new TypeError('The "columns" option must be an array.');if(!(c.isArray(cd.options.data)||"function"==typeof cd.options.data||cd.options.data instanceof Backbone.Collection))throw new TypeError('The "data" option must be an array, a function or a Backbone.Collection.');if("function"==typeof cd.options.data&&(oe=new cd.options.data,oe.grid=cd),["title","popup"].indexOf(cd.options.tooltipType)<0)throw'The "tooltipType" option be either "title" or "popup", not "'+cd.options.tooltipType+'".';cd.options.addRow&&!cd.options.editable&&(console.warn&&console.warn('In order to use "addRow", you must enable the "editable" parameter. The "addRow" option has been disabled.'),cd.options.addRow=!1),cd.options.resizableRows&&!Zc&&(Zc=!0),Xc(),cd.options.data instanceof Backbone.Collection&&ac()},Sb()};return d});